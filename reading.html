
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Reading in data locally and from the web &#8212; DSCΙ 100</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/style.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Cleaning and wrangling data" href="wrangling.html" />
    <link rel="prev" title="Python and the Pandas" href="intro.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      
      
      <h1 class="site-logo" id="site-title">DSCΙ 100</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="index.html">
   Welcome – TBD
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  First draft
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="preface-text.html">
   Preface – TBD
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="foreword-text.html">
   Foreword – TBD
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="acknowledgements.html">
   Acknowledgments – TBD
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="authors.html">
   About the authors – TBD
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="setup.html">
   Setting up your computer – TBD
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   Python and the Pandas
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Reading in data locally and from the web
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="wrangling.html">
   Cleaning and wrangling data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="viz.html">
   Effective data visualization
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="classification1.html">
   Classification I: training &amp; predicting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="classification2.html">
   Classification II: evaluation &amp; tuning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="regression1.html">
   Regression I: K-nearest neighbors
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="regression2.html">
   Regression II: linear regression
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="clustering.html">
   Clustering – TBD
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="inference.html">
   Statistical inference
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="references.html">
   References – TBD
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="appendixA.html">
   Appendix
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        <a class="dropdown-buttons"
            href="_sources/reading.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download notebook file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/reading.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#overview">
   Overview
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#chapter-learning-objectives">
   Chapter learning objectives
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#absolute-and-relative-file-paths">
   Absolute and relative file paths
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#reading-tabular-data-from-a-plain-text-file-into-python">
   Reading tabular data from a plain text file into Python
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#read-csv-to-read-in-comma-separated-files-readcsv">
     <code class="docutils literal notranslate">
      <span class="pre">
       read_csv
      </span>
     </code>
     to read in comma-separated files {#readcsv}
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#skipping-rows-when-reading-in-data">
     Skipping rows when reading in data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#read-csv-with-sep-argument-to-read-in-tab-separated-files">
     <code class="docutils literal notranslate">
      <span class="pre">
       read_csv
      </span>
     </code>
     with
     <code class="docutils literal notranslate">
      <span class="pre">
       sep
      </span>
     </code>
     argument to read in tab-separated files
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#read-table-as-a-more-flexible-method-to-get-tabular-data-into-python">
     <code class="docutils literal notranslate">
      <span class="pre">
       read_table
      </span>
     </code>
     as a more flexible method to get tabular data into Python
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#reading-tabular-data-directly-from-a-url">
     Reading tabular data directly from a URL
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#previewing-a-data-file-before-reading-it-into-python">
     Previewing a data file before reading it into Python
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#reading-tabular-data-from-a-microsoft-excel-file">
   Reading tabular data from a Microsoft Excel file
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#reading-data-from-a-database">
   Reading data from a database
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#reading-data-from-a-sqlite-database">
     Reading data from a SQLite database
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#reading-data-from-a-postgresql-database">
     Reading data from a PostgreSQL database
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#why-should-we-bother-with-databases-at-all">
     Why should we bother with databases at all?
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#writing-data-from-python-to-a-csv-file">
   Writing data from Python to a
   <code class="docutils literal notranslate">
    <span class="pre">
     .csv
    </span>
   </code>
   file
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#obtaining-data-from-the-web">
   Obtaining data from the web
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#web-scraping">
     Web scraping
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#html-and-css-selectors">
       HTML and CSS selectors {-}
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-an-api">
     Using an API
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercises">
   Exercises
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#additional-resources">
   Additional resources
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Reading in data locally and from the web</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#overview">
   Overview
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#chapter-learning-objectives">
   Chapter learning objectives
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#absolute-and-relative-file-paths">
   Absolute and relative file paths
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#reading-tabular-data-from-a-plain-text-file-into-python">
   Reading tabular data from a plain text file into Python
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#read-csv-to-read-in-comma-separated-files-readcsv">
     <code class="docutils literal notranslate">
      <span class="pre">
       read_csv
      </span>
     </code>
     to read in comma-separated files {#readcsv}
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#skipping-rows-when-reading-in-data">
     Skipping rows when reading in data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#read-csv-with-sep-argument-to-read-in-tab-separated-files">
     <code class="docutils literal notranslate">
      <span class="pre">
       read_csv
      </span>
     </code>
     with
     <code class="docutils literal notranslate">
      <span class="pre">
       sep
      </span>
     </code>
     argument to read in tab-separated files
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#read-table-as-a-more-flexible-method-to-get-tabular-data-into-python">
     <code class="docutils literal notranslate">
      <span class="pre">
       read_table
      </span>
     </code>
     as a more flexible method to get tabular data into Python
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#reading-tabular-data-directly-from-a-url">
     Reading tabular data directly from a URL
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#previewing-a-data-file-before-reading-it-into-python">
     Previewing a data file before reading it into Python
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#reading-tabular-data-from-a-microsoft-excel-file">
   Reading tabular data from a Microsoft Excel file
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#reading-data-from-a-database">
   Reading data from a database
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#reading-data-from-a-sqlite-database">
     Reading data from a SQLite database
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#reading-data-from-a-postgresql-database">
     Reading data from a PostgreSQL database
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#why-should-we-bother-with-databases-at-all">
     Why should we bother with databases at all?
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#writing-data-from-python-to-a-csv-file">
   Writing data from Python to a
   <code class="docutils literal notranslate">
    <span class="pre">
     .csv
    </span>
   </code>
   file
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#obtaining-data-from-the-web">
   Obtaining data from the web
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#web-scraping">
     Web scraping
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#html-and-css-selectors">
       HTML and CSS selectors {-}
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-an-api">
     Using an API
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercises">
   Exercises
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#additional-resources">
   Additional resources
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="reading-in-data-locally-and-from-the-web">
<h1>Reading in data locally and from the web<a class="headerlink" href="#reading-in-data-locally-and-from-the-web" title="Permalink to this headline">¶</a></h1>
<p>We need to import the <code class="docutils literal notranslate"><span class="pre">pandas</span></code> package in order to read data into Python</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>In this chapter, you’ll learn to read tabular data of various formats into Python
from your local device (e.g., your laptop) and the web. “Reading” (or “loading”)
\index{loading|see{reading}}\index{reading!definition} is the process of
converting data (stored as plain text, a database, HTML, etc.) into an object
(e.g., a data frame) that Python can easily access and manipulate. Thus reading data
is the gateway to any data analysis; you won’t be able to analyze data unless
you’ve loaded it first. And because there are many ways to store data, there
are similarly many ways to read data into Python. The more time you spend upfront
matching the data reading method to the type of data you have, the less time
you will have to devote to re-formatting, cleaning and wrangling your data (the
second step to all data analyses). It’s like making sure your shoelaces are
tied well before going for a run so that you don’t trip later on!</p>
</div>
<div class="section" id="chapter-learning-objectives">
<h2>Chapter learning objectives<a class="headerlink" href="#chapter-learning-objectives" title="Permalink to this headline">¶</a></h2>
<p>By the end of the chapter, readers will be able to do the following:</p>
<ul class="simple">
<li><p>Define the following:</p>
<ul>
<li><p>absolute file path</p></li>
<li><p>relative file path</p></li>
<li><p><strong>U</strong>niform <strong>R</strong>esource <strong>L</strong>ocator (URL)</p></li>
</ul>
</li>
<li><p>Read data into Python using an absolute path, relative path and a URL.</p></li>
<li><p>Compare and contrast the following functions:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">read_csv</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">read_table</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">read_excel</span></code></p></li>
</ul>
</li>
<li><p>Match the following <code class="docutils literal notranslate"><span class="pre">pandas</span></code> <code class="docutils literal notranslate"><span class="pre">.read_*</span></code> function arguments to their descriptions:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">filepath_or_buffer</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sep</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">names</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">skiprows</span></code></p></li>
</ul>
</li>
<li><p>Choose the appropriate <code class="docutils literal notranslate"><span class="pre">pandas</span></code> <code class="docutils literal notranslate"><span class="pre">.read_*</span></code> function and function arguments to load a given plain text tabular data set into Python.</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">pandas</span></code> package’s <code class="docutils literal notranslate"><span class="pre">read_excel</span></code> function and arguments to load a sheet from an excel file into Python.</p></li>
<li><p>Connect to a database using the <code class="docutils literal notranslate"><span class="pre">SQLAlchemy</span></code> library.</p></li>
<li><p>List the tables in a database using <code class="docutils literal notranslate"><span class="pre">SQLAlchemy</span></code> library’s <code class="docutils literal notranslate"><span class="pre">table_names</span></code> function</p></li>
<li><p>Create a reference to a database table that is queriable using the <code class="docutils literal notranslate"><span class="pre">SQLAlchemy</span></code> library’s <code class="docutils literal notranslate"><span class="pre">select</span></code>
and <code class="docutils literal notranslate"><span class="pre">where</span></code> functions</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">.to_csv</span></code> to save a data frame to a csv file</p></li>
<li><p>(<em>Optional</em>) Obtain data using <strong>a</strong>pplication <strong>p</strong>rogramming <strong>i</strong>nterfaces (APIs) and web scraping.</p>
<ul>
<li><p>Read/scrape data from an internet URL using the <code class="docutils literal notranslate"><span class="pre">BeautifulSoup</span></code> package</p></li>
<li><p>Compare downloading tabular data from a plain text file (e.g. *.csv) from the web versus scraping data from a .html file</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="absolute-and-relative-file-paths">
<h2>Absolute and relative file paths<a class="headerlink" href="#absolute-and-relative-file-paths" title="Permalink to this headline">¶</a></h2>
<p>This chapter will discuss the different functions we can use to import data
into Python, but before we can talk about <em>how</em> we read the data into Python with these
functions, we first need to talk about <em>where</em> the data lives. When you load a
data set into Python, you first need to tell Python where those files live. The file
could live on your  computer (<em>local</em>)
\index{location|see{path}} \index{path!local, remote, relative, absolute}
or somewhere on the internet (<em>remote</em>).</p>
<p>The place where the file lives on your computer is called the “path”. You can
think of the path as directions to the file. There are two kinds of paths:
<em>relative</em> paths and <em>absolute</em> paths. A relative path is where the file is
with respect to where you currently are on the computer (e.g., where the file
you’re working in is). On the other hand, an absolute path is where the file is
in respect to the computer’s filesystem base (or root) folder.</p>
<p>Suppose our computer’s filesystem looks like the picture in
<a class="reference internal" href="#filesystem"><span class="std std-numref">Fig. 9</span></a>, and we are working in a
file titled <code class="docutils literal notranslate"><span class="pre">worksheet_02.ipynb</span></code>. If we want to
read the <code class="docutils literal notranslate"><span class="pre">.csv</span></code> file named <code class="docutils literal notranslate"><span class="pre">happiness_report.csv</span></code> into Python, we could do this
using either a relative or an absolute path.  We show both choices
below.\index{Happiness Report}</p>
<div class="figure align-default" id="filesystem">
<a class="reference internal image-reference" href="_images/filesystem.jpeg"><img alt="_images/filesystem.jpeg" src="_images/filesystem.jpeg" style="height: 400px;" /></a>
<p class="caption"><span class="caption-number">Fig. 9 </span><span class="caption-text">Example file system</span><a class="headerlink" href="#filesystem" title="Permalink to this image">¶</a></p>
</div>
<p><strong>Reading <code class="docutils literal notranslate"><span class="pre">happiness_report.csv</span></code> using a relative path:</strong></p>
<div class="highlight-{code-cell notranslate"><div class="highlight"><pre><span></span>happy_data = pd.read_csv(&quot;data/happiness_report.csv&quot;)
</pre></div>
</div>
<p><strong>Reading <code class="docutils literal notranslate"><span class="pre">happiness_report.csv</span></code> using an absolute path:</strong></p>
<div class="highlight-{code-cell notranslate"><div class="highlight"><pre><span></span>happy_data = pd.read_csv(&quot;/home/dsci-100/worksheet_02/data/happiness_report.csv&quot;)
</pre></div>
</div>
<p>So which one should you use? Generally speaking, to ensure your code can be run
on a different computer, you should use relative paths. An added bonus is that
it’s also less typing! Generally, you should use relative paths because the file’s
absolute path (the names of
folders between the computer’s root <code class="docutils literal notranslate"><span class="pre">/</span></code> and the file) isn’t usually the same
across different computers. For example, suppose Fatima and Jayden are working on a
project together on the <code class="docutils literal notranslate"><span class="pre">happiness_report.csv</span></code> data. Fatima’s file is stored at</p>
<p><code class="docutils literal notranslate"><span class="pre">/home/Fatima/project/data/happiness_report.csv</span></code>,</p>
<p>while Jayden’s is stored at</p>
<p><code class="docutils literal notranslate"><span class="pre">/home/Jayden/project/data/happiness_report.csv</span></code>.</p>
<p>Even though Fatima and Jayden stored their files in the same place on their
computers (in their home folders), the absolute paths are different due to
their different usernames.  If Jayden has code that loads the
<code class="docutils literal notranslate"><span class="pre">happiness_report.csv</span></code> data using an absolute path, the code won’t work on
Fatima’s computer.  But the relative path from inside the <code class="docutils literal notranslate"><span class="pre">project</span></code> folder
(<code class="docutils literal notranslate"><span class="pre">data/happiness_report.csv</span></code>) is the same on both computers; any code that uses
relative paths will work on both!</p>
<p>Your file could be stored locally, as we discussed, or it could also be
somewhere on the internet (remotely). A <em>Uniform Resource Locator (URL)</em> (web
address) \index{URL} indicates the location of a resource on the internet and
helps us retrieve that resource. Next, we will discuss how to get either
locally or remotely stored data into Python.</p>
</div>
<div class="section" id="reading-tabular-data-from-a-plain-text-file-into-python">
<h2>Reading tabular data from a plain text file into Python<a class="headerlink" href="#reading-tabular-data-from-a-plain-text-file-into-python" title="Permalink to this headline">¶</a></h2>
<div class="section" id="read-csv-to-read-in-comma-separated-files-readcsv">
<h3><code class="docutils literal notranslate"><span class="pre">read_csv</span></code> to read in comma-separated files {#readcsv}<a class="headerlink" href="#read-csv-to-read-in-comma-separated-files-readcsv" title="Permalink to this headline">¶</a></h3>
<p>Now that we have learned about <em>where</em> data could be, we will learn about <em>how</em>
to import data into Python using various functions. Specifically, we will learn how
to <em>read</em> tabular data from a plain text file (a document containing only text)
<em>into</em> Python and <em>write</em> tabular data to a file <em>out of</em> Python. The function we use to do this
depends on the file’s format. For example, in the last chapter, we learned about using
the <code class="docutils literal notranslate"><span class="pre">pandas</span></code> <code class="docutils literal notranslate"><span class="pre">read_csv</span></code> function when reading .csv (<strong>c</strong>omma-<strong>s</strong>eparated <strong>v</strong>alues)
files. \index{csv} In that case, the separator or <em>delimiter</em> \index{reading!delimiter} that divided our columns was a
comma (<code class="docutils literal notranslate"><span class="pre">,</span></code>). We only learned the case where the data matched the expected defaults
of the <code class="docutils literal notranslate"><span class="pre">read_csv</span></code> function \index{read function!read_csv}
(column names are present, and commas are used as the delimiter between columns).
In this section, we will learn how to read
files that do not satisfy the default expectations of <code class="docutils literal notranslate"><span class="pre">read_csv</span></code>.</p>
<p>Before we jump into the cases where the data aren’t in the expected default format
for <code class="docutils literal notranslate"><span class="pre">pandas</span></code> and <code class="docutils literal notranslate"><span class="pre">read_csv</span></code>, let’s revisit the more straightforward
case where the defaults hold, and the only argument we need to give to the function
is the path to the file, <code class="docutils literal notranslate"><span class="pre">data/can_lang.csv</span></code>. The <code class="docutils literal notranslate"><span class="pre">can_lang</span></code> data set contains
language data from the 2016 Canadian census. \index{Canadian languages!canlang data}
We put <code class="docutils literal notranslate"><span class="pre">data/</span></code> before the file’s
name when we are loading the data set because this data set is located in a
sub-folder, named <code class="docutils literal notranslate"><span class="pre">data</span></code>, relative to where we are running our Python code.</p>
<p>Here is what the file would look like in a plain text editor (a program that removes
all formatting, like bolding or different fonts):</p>
<div class="highlight-code notranslate"><div class="highlight"><pre><span></span>category,language,mother_tongue,most_at_home,most_at_work,lang_known
Aboriginal languages,&quot;Aboriginal languages, n.o.s.&quot;,590,235,30,665
Non-Official &amp; Non-Aboriginal languages,Afrikaans,10260,4785,85,23415
Non-Official &amp; Non-Aboriginal languages,&quot;Afro-Asiatic languages, n.i.e.&quot;,1150,44
Non-Official &amp; Non-Aboriginal languages,Akan (Twi),13460,5985,25,22150
Non-Official &amp; Non-Aboriginal languages,Albanian,26895,13135,345,31930
Aboriginal languages,&quot;Algonquian languages, n.i.e.&quot;,45,10,0,120
Aboriginal languages,Algonquin,1260,370,40,2480
Non-Official &amp; Non-Aboriginal languages,American Sign Language,2685,3020,1145,21
Non-Official &amp; Non-Aboriginal languages,Amharic,22465,12785,200,33670
</pre></div>
</div>
<p>And here is a review of how we can use <code class="docutils literal notranslate"><span class="pre">read_csv</span></code> to load it into Python. First we
load the <code class="docutils literal notranslate"><span class="pre">pandas</span></code> \index{tidyverse} package to gain access to useful
functions for reading the data.</p>
<p>Next we use <code class="docutils literal notranslate"><span class="pre">read_csv</span></code> to load the data into Python, and in that call we specify the
relative path to the file.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">canlang_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/can_lang.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="nn">Input In [3],</span> in <span class="ni">&lt;cell line: 1&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">canlang_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/can_lang.csv&quot;</span><span class="p">)</span>

<span class="nn">File ~/opt/miniconda3/envs/dsci/lib/python3.9/site-packages/pandas/util/_decorators.py:311,</span> in <span class="ni">deprecate_nonkeyword_arguments.&lt;locals&gt;.decorate.&lt;locals&gt;.wrapper</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">305</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">num_allow_args</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">306</span>     <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">307</span>         <span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">arguments</span><span class="o">=</span><span class="n">arguments</span><span class="p">),</span>
<span class="g g-Whitespace">    </span><span class="mi">308</span>         <span class="ne">FutureWarning</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">309</span>         <span class="n">stacklevel</span><span class="o">=</span><span class="n">stacklevel</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">310</span>     <span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">311</span> <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nn">File ~/opt/miniconda3/envs/dsci/lib/python3.9/site-packages/pandas/io/parsers/readers.py:680,</span> in <span class="ni">read_csv</span><span class="nt">(filepath_or_buffer, sep, delimiter, header, names, index_col, usecols, squeeze, prefix, mangle_dupe_cols, dtype, engine, converters, true_values, false_values, skipinitialspace, skiprows, skipfooter, nrows, na_values, keep_default_na, na_filter, verbose, skip_blank_lines, parse_dates, infer_datetime_format, keep_date_col, date_parser, dayfirst, cache_dates, iterator, chunksize, compression, thousands, decimal, lineterminator, quotechar, quoting, doublequote, escapechar, comment, encoding, encoding_errors, dialect, error_bad_lines, warn_bad_lines, on_bad_lines, delim_whitespace, low_memory, memory_map, float_precision, storage_options)</span>
<span class="g g-Whitespace">    </span><span class="mi">665</span> <span class="n">kwds_defaults</span> <span class="o">=</span> <span class="n">_refine_defaults_read</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">666</span>     <span class="n">dialect</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">667</span>     <span class="n">delimiter</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">676</span>     <span class="n">defaults</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;delimiter&quot;</span><span class="p">:</span> <span class="s2">&quot;,&quot;</span><span class="p">},</span>
<span class="g g-Whitespace">    </span><span class="mi">677</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">678</span> <span class="n">kwds</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwds_defaults</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">680</span> <span class="k">return</span> <span class="n">_read</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>

<span class="nn">File ~/opt/miniconda3/envs/dsci/lib/python3.9/site-packages/pandas/io/parsers/readers.py:575,</span> in <span class="ni">_read</span><span class="nt">(filepath_or_buffer, kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">572</span> <span class="n">_validate_names</span><span class="p">(</span><span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;names&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
<span class="g g-Whitespace">    </span><span class="mi">574</span> <span class="c1"># Create the parser.</span>
<span class="ne">--&gt; </span><span class="mi">575</span> <span class="n">parser</span> <span class="o">=</span> <span class="n">TextFileReader</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">577</span> <span class="k">if</span> <span class="n">chunksize</span> <span class="ow">or</span> <span class="n">iterator</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">578</span>     <span class="k">return</span> <span class="n">parser</span>

<span class="nn">File ~/opt/miniconda3/envs/dsci/lib/python3.9/site-packages/pandas/io/parsers/readers.py:933,</span> in <span class="ni">TextFileReader.__init__</span><span class="nt">(self, f, engine, **kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">930</span>     <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;has_index_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwds</span><span class="p">[</span><span class="s2">&quot;has_index_names&quot;</span><span class="p">]</span>
<span class="g g-Whitespace">    </span><span class="mi">932</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">:</span> <span class="n">IOHandles</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="ne">--&gt; </span><span class="mi">933</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_engine</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span>

<span class="nn">File ~/opt/miniconda3/envs/dsci/lib/python3.9/site-packages/pandas/io/parsers/readers.py:1217,</span> in <span class="ni">TextFileReader._make_engine</span><span class="nt">(self, f, engine)</span>
<span class="g g-Whitespace">   </span><span class="mi">1213</span>     <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;rb&quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">1214</span> <span class="c1"># error: No overload variant of &quot;get_handle&quot; matches argument types</span>
<span class="g g-Whitespace">   </span><span class="mi">1215</span> <span class="c1"># &quot;Union[str, PathLike[str], ReadCsvBuffer[bytes], ReadCsvBuffer[str]]&quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">1216</span> <span class="c1"># , &quot;str&quot;, &quot;bool&quot;, &quot;Any&quot;, &quot;Any&quot;, &quot;Any&quot;, &quot;Any&quot;, &quot;Any&quot;</span>
<span class="ne">-&gt; </span><span class="mi">1217</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span> <span class="o">=</span> <span class="n">get_handle</span><span class="p">(</span>  <span class="c1"># type: ignore[call-overload]</span>
<span class="g g-Whitespace">   </span><span class="mi">1218</span>     <span class="n">f</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1219</span>     <span class="n">mode</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1220</span>     <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;encoding&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1221</span>     <span class="n">compression</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;compression&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1222</span>     <span class="n">memory_map</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;memory_map&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1223</span>     <span class="n">is_text</span><span class="o">=</span><span class="n">is_text</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1224</span>     <span class="n">errors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;encoding_errors&quot;</span><span class="p">,</span> <span class="s2">&quot;strict&quot;</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1225</span>     <span class="n">storage_options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;storage_options&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1226</span> <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1227</span> <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="g g-Whitespace">   </span><span class="mi">1228</span> <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="o">.</span><span class="n">handle</span>

<span class="nn">File ~/opt/miniconda3/envs/dsci/lib/python3.9/site-packages/pandas/io/common.py:789,</span> in <span class="ni">get_handle</span><span class="nt">(path_or_buf, mode, encoding, compression, memory_map, is_text, errors, storage_options)</span>
<span class="g g-Whitespace">    </span><span class="mi">784</span> <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">785</span>     <span class="c1"># Check whether the filename is to be opened in binary mode.</span>
<span class="g g-Whitespace">    </span><span class="mi">786</span>     <span class="c1"># Binary mode does not support &#39;encoding&#39; and &#39;newline&#39;.</span>
<span class="g g-Whitespace">    </span><span class="mi">787</span>     <span class="k">if</span> <span class="n">ioargs</span><span class="o">.</span><span class="n">encoding</span> <span class="ow">and</span> <span class="s2">&quot;b&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ioargs</span><span class="o">.</span><span class="n">mode</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">788</span>         <span class="c1"># Encoding</span>
<span class="ne">--&gt; </span><span class="mi">789</span>         <span class="n">handle</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">790</span>             <span class="n">handle</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">791</span>             <span class="n">ioargs</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">792</span>             <span class="n">encoding</span><span class="o">=</span><span class="n">ioargs</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">793</span>             <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">794</span>             <span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">795</span>         <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">796</span>     <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">797</span>         <span class="c1"># Binary mode</span>
<span class="g g-Whitespace">    </span><span class="mi">798</span>         <span class="n">handle</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">ioargs</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>

<span class="ne">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;data/can_lang.csv&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">canlang_data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">Input In [4],</span> in <span class="ni">&lt;cell line: 1&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">canlang_data</span>

<span class="ne">NameError</span>: name &#39;canlang_data&#39; is not defined
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="skipping-rows-when-reading-in-data">
<h3>Skipping rows when reading in data<a class="headerlink" href="#skipping-rows-when-reading-in-data" title="Permalink to this headline">¶</a></h3>
<p>Oftentimes, information about how data was collected, or other relevant
information, is included at the top of the data file. This information is
usually written in sentence and paragraph form, with no delimiter because it is
not organized into columns. An example of this is shown below. This information
gives the data scientist useful context and information about the data,
however, it is not well formatted or intended to be read into a data frame cell
along with the tabular data that follows later in the file.</p>
<div class="highlight-code notranslate"><div class="highlight"><pre><span></span>Data source: https://ttimbers.github.io/canlang/
Data originally published in: Statistics Canada Census of Population 2016.
Reproduced and distributed on an as-is basis with their permission.
category,language,mother_tongue,most_at_home,most_at_work,lang_known
Aboriginal languages,&quot;Aboriginal languages, n.o.s.&quot;,590,235,30,665
Non-Official &amp; Non-Aboriginal languages,Afrikaans,10260,4785,85,23415
Non-Official &amp; Non-Aboriginal languages,&quot;Afro-Asiatic languages, n.i.e.&quot;,1150,44
Non-Official &amp; Non-Aboriginal languages,Akan (Twi),13460,5985,25,22150
Non-Official &amp; Non-Aboriginal languages,Albanian,26895,13135,345,31930
Aboriginal languages,&quot;Algonquian languages, n.i.e.&quot;,45,10,0,120
Aboriginal languages,Algonquin,1260,370,40,2480
Non-Official &amp; Non-Aboriginal languages,American Sign Language,2685,3020,1145,21
Non-Official &amp; Non-Aboriginal languages,Amharic,22465,12785,200,33670
</pre></div>
</div>
<p>With this extra information being present at the top of the file, using
<code class="docutils literal notranslate"><span class="pre">read_csv</span></code> as we did previously does not allow us to correctly load the data
into Python. In the case of this file we end up only reading in one column of the
data set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">canlang_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/can_lang-meta-data.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ParserError</span><span class="p">:</span> <span class="n">Error</span> <span class="n">tokenizing</span> <span class="n">data</span><span class="o">.</span> <span class="n">C</span> <span class="n">error</span><span class="p">:</span> <span class="n">Expected</span> <span class="mi">3</span> <span class="n">fields</span> <span class="ow">in</span> <span class="n">line</span> <span class="mi">3</span><span class="p">,</span> <span class="n">saw</span> <span class="mi">6</span>
</pre></div>
</div>
<blockquote>
<div><p><strong>Note:</strong> In contrast to the normal and expected messages above, this time Python
printed out a Parsing error for us indicating that there might be a problem with how
our data is being read in. \index{warning}</p>
</div></blockquote>
<p>To successfully read data like this into Python, the <code class="docutils literal notranslate"><span class="pre">skiprows</span></code>
argument \index{read function!skip argument} can be useful to tell Python
how many lines to skip before
it should start reading in the data. In the example above, we would set this
value to 2 and pass <code class="docutils literal notranslate"><span class="pre">header</span></code> as None to read and load the data correctly.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">canlang_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/can_lang-meta-data.csv&quot;</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">canlang_data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Aboriginal languages</td>
      <td>Aboriginal languages, n.o.s.</td>
      <td>590</td>
      <td>235</td>
      <td>30</td>
      <td>665</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Afrikaans</td>
      <td>10260</td>
      <td>4785</td>
      <td>85</td>
      <td>23415</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Afro-Asiatic languages, n.i.e.</td>
      <td>1150</td>
      <td>445</td>
      <td>10</td>
      <td>2775</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Akan (Twi)</td>
      <td>13460</td>
      <td>5985</td>
      <td>25</td>
      <td>22150</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Albanian</td>
      <td>26895</td>
      <td>13135</td>
      <td>345</td>
      <td>31930</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>423</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Wolof</td>
      <td>3990</td>
      <td>1385</td>
      <td>10</td>
      <td>8240</td>
    </tr>
    <tr>
      <th>424</th>
      <td>Aboriginal languages</td>
      <td>Woods Cree</td>
      <td>1840</td>
      <td>800</td>
      <td>75</td>
      <td>2665</td>
    </tr>
    <tr>
      <th>425</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Wu (Shanghainese)</td>
      <td>12915</td>
      <td>7650</td>
      <td>105</td>
      <td>16530</td>
    </tr>
    <tr>
      <th>426</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Yiddish</td>
      <td>13555</td>
      <td>7085</td>
      <td>895</td>
      <td>20985</td>
    </tr>
    <tr>
      <th>427</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Yoruba</td>
      <td>9080</td>
      <td>2615</td>
      <td>15</td>
      <td>22415</td>
    </tr>
  </tbody>
</table>
<p>428 rows × 6 columns</p>
</div></div></div>
</div>
<p>How did we know to skip two lines? We looked at the data! The first two lines
of the data had information we didn’t need to import:</p>
<div class="highlight-code notranslate"><div class="highlight"><pre><span></span>Source: Statistics Canada, Census of Population, 2016. Reproduced and distributed on an &quot;as is&quot; basis with the permission of Statistics Canada.
Date collected: 2020/07/09
</pre></div>
</div>
<p>The column names began at line 3, so we skipped the first two lines.</p>
</div>
<div class="section" id="read-csv-with-sep-argument-to-read-in-tab-separated-files">
<h3><code class="docutils literal notranslate"><span class="pre">read_csv</span></code> with <code class="docutils literal notranslate"><span class="pre">sep</span></code> argument to read in tab-separated files<a class="headerlink" href="#read-csv-with-sep-argument-to-read-in-tab-separated-files" title="Permalink to this headline">¶</a></h3>
<p>Another common way data is stored is with tabs as the delimiter. Notice the
data file, <code class="docutils literal notranslate"><span class="pre">can_lang.tsv</span></code>, has tabs in between the columns instead of
commas.</p>
<div class="highlight-code notranslate"><div class="highlight"><pre><span></span>category    language    mother_tongue   most_at_home    most_at_work    lang_kno
Aboriginal languages    Aboriginal languages, n.o.s.    590 235 30  665
Non-Official &amp; Non-Aboriginal languages Afrikaans   10260   4785    85  23415
Non-Official &amp; Non-Aboriginal languages Afro-Asiatic languages, n.i.e.  1150    
Non-Official &amp; Non-Aboriginal languages Akan (Twi)  13460   5985    25  22150
Non-Official &amp; Non-Aboriginal languages Albanian    26895   13135   345 31930
Aboriginal languages    Algonquian languages, n.i.e.    45  10  0   120
Aboriginal languages    Algonquin   1260    370 40  2480
Non-Official &amp; Non-Aboriginal languages American Sign Language  2685    3020    
Non-Official &amp; Non-Aboriginal languages Amharic 22465   12785   200 33670
</pre></div>
</div>
<p>To read in this type of data, we can use the <code class="docutils literal notranslate"><span class="pre">read_csv</span></code> with <code class="docutils literal notranslate"><span class="pre">sep</span></code> argument
\index{tab-separated values|see{tsv}}\index{tsv}\index{read function!read_tsv}
to read in .tsv (<strong>t</strong>ab <strong>s</strong>eparated <strong>v</strong>alues) files.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">canlang_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/can_lang.tsv&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">canlang_data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Aboriginal languages</td>
      <td>Aboriginal languages, n.o.s.</td>
      <td>590</td>
      <td>235</td>
      <td>30</td>
      <td>665</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Afrikaans</td>
      <td>10260</td>
      <td>4785</td>
      <td>85</td>
      <td>23415</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Afro-Asiatic languages, n.i.e.</td>
      <td>1150</td>
      <td>445</td>
      <td>10</td>
      <td>2775</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Akan (Twi)</td>
      <td>13460</td>
      <td>5985</td>
      <td>25</td>
      <td>22150</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Albanian</td>
      <td>26895</td>
      <td>13135</td>
      <td>345</td>
      <td>31930</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>209</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Wolof</td>
      <td>3990</td>
      <td>1385</td>
      <td>10</td>
      <td>8240</td>
    </tr>
    <tr>
      <th>210</th>
      <td>Aboriginal languages</td>
      <td>Woods Cree</td>
      <td>1840</td>
      <td>800</td>
      <td>75</td>
      <td>2665</td>
    </tr>
    <tr>
      <th>211</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Wu (Shanghainese)</td>
      <td>12915</td>
      <td>7650</td>
      <td>105</td>
      <td>16530</td>
    </tr>
    <tr>
      <th>212</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Yiddish</td>
      <td>13555</td>
      <td>7085</td>
      <td>895</td>
      <td>20985</td>
    </tr>
    <tr>
      <th>213</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Yoruba</td>
      <td>9080</td>
      <td>2615</td>
      <td>15</td>
      <td>22415</td>
    </tr>
  </tbody>
</table>
<p>214 rows × 6 columns</p>
</div></div></div>
</div>
<p>Let’s compare the data frame here to the resulting data frame in Section
&#64;ref(readcsv) after using <code class="docutils literal notranslate"><span class="pre">read_csv</span></code>. Notice anything? They look the same! The
same number of columns/rows and column names! So we needed to use different
tools for the job depending on the file format and our resulting table
(<code class="docutils literal notranslate"><span class="pre">canlang_data</span></code>) in both cases was the same!</p>
</div>
<div class="section" id="read-table-as-a-more-flexible-method-to-get-tabular-data-into-python">
<h3><code class="docutils literal notranslate"><span class="pre">read_table</span></code> as a more flexible method to get tabular data into Python<a class="headerlink" href="#read-table-as-a-more-flexible-method-to-get-tabular-data-into-python" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">read_csv</span></code> and <code class="docutils literal notranslate"><span class="pre">read_csv</span></code> with argument <code class="docutils literal notranslate"><span class="pre">sep</span></code> are actually just special cases of the more general
<code class="docutils literal notranslate"><span class="pre">read_table</span></code> \index{read function!read_delim} function. We can use
<code class="docutils literal notranslate"><span class="pre">read_table</span></code> to import both comma and tab-separated files (and more), we just
have to specify the delimiter. The <code class="docutils literal notranslate"><span class="pre">can_lang.tsv</span></code> is a different version of
this same data set with no column names and uses tabs as the delimiter
\index{reading!delimiter} instead of commas.</p>
<p>Here is how the file would look in a plain text editor:</p>
<div class="highlight-code notranslate"><div class="highlight"><pre><span></span>Aboriginal languages    Aboriginal languages, n.o.s.    590 235 30  665
Non-Official &amp; Non-Aboriginal languages Afrikaans   10260   4785    85  23415
Non-Official &amp; Non-Aboriginal languages Afro-Asiatic languages, n.i.e.  1150    
Non-Official &amp; Non-Aboriginal languages Akan (Twi)  13460   5985    25  22150
Non-Official &amp; Non-Aboriginal languages Albanian    26895   13135   345 31930
Aboriginal languages    Algonquian languages, n.i.e.    45  10  0   120
Aboriginal languages    Algonquin   1260    370 40  2480
Non-Official &amp; Non-Aboriginal languages American Sign Language  2685    3020    
Non-Official &amp; Non-Aboriginal languages Amharic 22465   12785   200 33670
Non-Official &amp; Non-Aboriginal languages Arabic  419890  223535  5585    629055
</pre></div>
</div>
<p>To get this into Python using the <code class="docutils literal notranslate"><span class="pre">read_table</span></code> function, we specify the first
argument as the path to the file (as done with <code class="docutils literal notranslate"><span class="pre">read_csv</span></code>), and then provide
values to the <code class="docutils literal notranslate"><span class="pre">sep</span></code> \index{read function!delim argument} argument (here a
tab, which we represent by <code class="docutils literal notranslate"><span class="pre">&quot;\t&quot;</span></code>).</p>
<blockquote>
<div><p><strong>Note:</strong> <code class="docutils literal notranslate"><span class="pre">\t</span></code> is an example of an <em>escaped character</em>,
which always starts with a backslash (<code class="docutils literal notranslate"><span class="pre">\</span></code>). \index{escape character}
Escaped characters are used to represent non-printing characters
(like the tab) or characters with special meanings (such as quotation marks).</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">canlang_data</span> <span class="o">=</span>  <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/can_lang.tsv&quot;</span><span class="p">,</span> 
                           <span class="n">sep</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> 
                           <span class="n">header</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>
<span class="n">canlang_data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Aboriginal languages</td>
      <td>Aboriginal languages, n.o.s.</td>
      <td>590</td>
      <td>235</td>
      <td>30</td>
      <td>665</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Afrikaans</td>
      <td>10260</td>
      <td>4785</td>
      <td>85</td>
      <td>23415</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Afro-Asiatic languages, n.i.e.</td>
      <td>1150</td>
      <td>445</td>
      <td>10</td>
      <td>2775</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Akan (Twi)</td>
      <td>13460</td>
      <td>5985</td>
      <td>25</td>
      <td>22150</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Albanian</td>
      <td>26895</td>
      <td>13135</td>
      <td>345</td>
      <td>31930</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>209</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Wolof</td>
      <td>3990</td>
      <td>1385</td>
      <td>10</td>
      <td>8240</td>
    </tr>
    <tr>
      <th>210</th>
      <td>Aboriginal languages</td>
      <td>Woods Cree</td>
      <td>1840</td>
      <td>800</td>
      <td>75</td>
      <td>2665</td>
    </tr>
    <tr>
      <th>211</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Wu (Shanghainese)</td>
      <td>12915</td>
      <td>7650</td>
      <td>105</td>
      <td>16530</td>
    </tr>
    <tr>
      <th>212</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Yiddish</td>
      <td>13555</td>
      <td>7085</td>
      <td>895</td>
      <td>20985</td>
    </tr>
    <tr>
      <th>213</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Yoruba</td>
      <td>9080</td>
      <td>2615</td>
      <td>15</td>
      <td>22415</td>
    </tr>
  </tbody>
</table>
<p>214 rows × 6 columns</p>
</div></div></div>
</div>
<p>Data frames in Python need to have column names.  Thus if you read in data that
don’t have column names, Python will assign names automatically. In the example
above, Python assigns each column a name of <code class="docutils literal notranslate"><span class="pre">0,</span> <span class="pre">1,</span> <span class="pre">2,</span> <span class="pre">3,</span> <span class="pre">4,</span> <span class="pre">5</span></code>.</p>
<p>It is best to rename your columns to help differentiate between them
(e.g., <code class="docutils literal notranslate"><span class="pre">0,</span> <span class="pre">1</span></code>, etc., are not very descriptive names and will make it more confusing as
you code). To rename your columns, you can use the <code class="docutils literal notranslate"><span class="pre">rename</span></code> function
\index{rename} from the <a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.rename.html">pandas package</a>.
The argument of the <code class="docutils literal notranslate"><span class="pre">rename</span></code> function is <code class="docutils literal notranslate"><span class="pre">columns</span></code>, which is a dictionary,
where the keys are the old column names and values are the new column names.
We rename the old <code class="docutils literal notranslate"><span class="pre">0,</span> <span class="pre">1,</span> <span class="pre">...,</span> <span class="pre">5</span></code>
columns in the <code class="docutils literal notranslate"><span class="pre">canlang_data</span></code> data frame to more descriptive names below, with the
<code class="docutils literal notranslate"><span class="pre">inplace</span></code> argument as <code class="docutils literal notranslate"><span class="pre">True</span></code>, so that the columns are renamed in place.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">canlang_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="s1">&#39;category&#39;</span><span class="p">,</span> 
                               <span class="mi">1</span><span class="p">:</span><span class="s1">&#39;language&#39;</span><span class="p">,</span>
                               <span class="mi">2</span><span class="p">:</span><span class="s1">&#39;mother_tongue&#39;</span><span class="p">,</span>
                               <span class="mi">3</span><span class="p">:</span><span class="s1">&#39;most_at_home&#39;</span><span class="p">,</span>
                               <span class="mi">4</span><span class="p">:</span><span class="s1">&#39;most_at_work&#39;</span><span class="p">,</span>
                               <span class="mi">5</span><span class="p">:</span><span class="s1">&#39;lang_known&#39;</span><span class="p">},</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
                               
                               
<span class="n">canlang_data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>category</th>
      <th>language</th>
      <th>mother_tongue</th>
      <th>most_at_home</th>
      <th>most_at_work</th>
      <th>lang_known</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Aboriginal languages</td>
      <td>Aboriginal languages, n.o.s.</td>
      <td>590</td>
      <td>235</td>
      <td>30</td>
      <td>665</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Afrikaans</td>
      <td>10260</td>
      <td>4785</td>
      <td>85</td>
      <td>23415</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Afro-Asiatic languages, n.i.e.</td>
      <td>1150</td>
      <td>445</td>
      <td>10</td>
      <td>2775</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Akan (Twi)</td>
      <td>13460</td>
      <td>5985</td>
      <td>25</td>
      <td>22150</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Albanian</td>
      <td>26895</td>
      <td>13135</td>
      <td>345</td>
      <td>31930</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>209</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Wolof</td>
      <td>3990</td>
      <td>1385</td>
      <td>10</td>
      <td>8240</td>
    </tr>
    <tr>
      <th>210</th>
      <td>Aboriginal languages</td>
      <td>Woods Cree</td>
      <td>1840</td>
      <td>800</td>
      <td>75</td>
      <td>2665</td>
    </tr>
    <tr>
      <th>211</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Wu (Shanghainese)</td>
      <td>12915</td>
      <td>7650</td>
      <td>105</td>
      <td>16530</td>
    </tr>
    <tr>
      <th>212</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Yiddish</td>
      <td>13555</td>
      <td>7085</td>
      <td>895</td>
      <td>20985</td>
    </tr>
    <tr>
      <th>213</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Yoruba</td>
      <td>9080</td>
      <td>2615</td>
      <td>15</td>
      <td>22415</td>
    </tr>
  </tbody>
</table>
<p>214 rows × 6 columns</p>
</div></div></div>
</div>
<p>The column names can also be assigned to the dataframe while reading it from the file by passing a
list of column names to the <code class="docutils literal notranslate"><span class="pre">names</span></code> argument. <code class="docutils literal notranslate"><span class="pre">read_csv</span></code> and <code class="docutils literal notranslate"><span class="pre">read_table</span></code> have a <code class="docutils literal notranslate"><span class="pre">names</span></code> argument,
\index{read function!col_names argument} whose default value is <code class="docutils literal notranslate"><span class="pre">[]</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">canlang_data</span> <span class="o">=</span>  <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/can_lang.tsv&quot;</span><span class="p">,</span> 
                           <span class="n">sep</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> 
                           <span class="n">header</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                           <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">,</span> <span class="s1">&#39;language&#39;</span><span class="p">,</span> <span class="s1">&#39;mother_tongue&#39;</span><span class="p">,</span> <span class="s1">&#39;most_at_home&#39;</span><span class="p">,</span> <span class="s1">&#39;most_at_work&#39;</span><span class="p">,</span> <span class="s1">&#39;lang_known&#39;</span><span class="p">])</span>
<span class="n">canlang_data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>category</th>
      <th>language</th>
      <th>mother_tongue</th>
      <th>most_at_home</th>
      <th>most_at_work</th>
      <th>lang_known</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Aboriginal languages</td>
      <td>Aboriginal languages, n.o.s.</td>
      <td>590</td>
      <td>235</td>
      <td>30</td>
      <td>665</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Afrikaans</td>
      <td>10260</td>
      <td>4785</td>
      <td>85</td>
      <td>23415</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Afro-Asiatic languages, n.i.e.</td>
      <td>1150</td>
      <td>445</td>
      <td>10</td>
      <td>2775</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Akan (Twi)</td>
      <td>13460</td>
      <td>5985</td>
      <td>25</td>
      <td>22150</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Albanian</td>
      <td>26895</td>
      <td>13135</td>
      <td>345</td>
      <td>31930</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>209</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Wolof</td>
      <td>3990</td>
      <td>1385</td>
      <td>10</td>
      <td>8240</td>
    </tr>
    <tr>
      <th>210</th>
      <td>Aboriginal languages</td>
      <td>Woods Cree</td>
      <td>1840</td>
      <td>800</td>
      <td>75</td>
      <td>2665</td>
    </tr>
    <tr>
      <th>211</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Wu (Shanghainese)</td>
      <td>12915</td>
      <td>7650</td>
      <td>105</td>
      <td>16530</td>
    </tr>
    <tr>
      <th>212</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Yiddish</td>
      <td>13555</td>
      <td>7085</td>
      <td>895</td>
      <td>20985</td>
    </tr>
    <tr>
      <th>213</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Yoruba</td>
      <td>9080</td>
      <td>2615</td>
      <td>15</td>
      <td>22415</td>
    </tr>
  </tbody>
</table>
<p>214 rows × 6 columns</p>
</div></div></div>
</div>
</div>
<div class="section" id="reading-tabular-data-directly-from-a-url">
<h3>Reading tabular data directly from a URL<a class="headerlink" href="#reading-tabular-data-directly-from-a-url" title="Permalink to this headline">¶</a></h3>
<p>We can also use <code class="docutils literal notranslate"><span class="pre">read_csv</span></code>, <code class="docutils literal notranslate"><span class="pre">read_table</span></code>(and related functions)
to read in data directly from a <strong>U</strong>niform <strong>R</strong>esource <strong>L</strong>ocator (URL) that
contains tabular data. \index{URL!reading from} Here, we provide the URL to
<code class="docutils literal notranslate"><span class="pre">read_*</span></code> as the path to the file instead of a path to a local file on our
computer. We need to surround the URL with quotes similar to when we specify a
path on our local computer. All other arguments that we use are the same as
when using these functions with a local file on our computer.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/UBC-DSCI/introduction-to-datascience-python/reading/source/data/can_lang.csv&quot;</span>
<span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="n">canlang_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

<span class="n">canlang_data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>category</th>
      <th>language</th>
      <th>mother_tongue</th>
      <th>most_at_home</th>
      <th>most_at_work</th>
      <th>lang_known</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Aboriginal languages</td>
      <td>Aboriginal languages, n.o.s.</td>
      <td>590</td>
      <td>235</td>
      <td>30</td>
      <td>665</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Afrikaans</td>
      <td>10260</td>
      <td>4785</td>
      <td>85</td>
      <td>23415</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Afro-Asiatic languages, n.i.e.</td>
      <td>1150</td>
      <td>445</td>
      <td>10</td>
      <td>2775</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Akan (Twi)</td>
      <td>13460</td>
      <td>5985</td>
      <td>25</td>
      <td>22150</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Albanian</td>
      <td>26895</td>
      <td>13135</td>
      <td>345</td>
      <td>31930</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>209</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Wolof</td>
      <td>3990</td>
      <td>1385</td>
      <td>10</td>
      <td>8240</td>
    </tr>
    <tr>
      <th>210</th>
      <td>Aboriginal languages</td>
      <td>Woods Cree</td>
      <td>1840</td>
      <td>800</td>
      <td>75</td>
      <td>2665</td>
    </tr>
    <tr>
      <th>211</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Wu (Shanghainese)</td>
      <td>12915</td>
      <td>7650</td>
      <td>105</td>
      <td>16530</td>
    </tr>
    <tr>
      <th>212</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Yiddish</td>
      <td>13555</td>
      <td>7085</td>
      <td>895</td>
      <td>20985</td>
    </tr>
    <tr>
      <th>213</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Yoruba</td>
      <td>9080</td>
      <td>2615</td>
      <td>15</td>
      <td>22415</td>
    </tr>
  </tbody>
</table>
<p>214 rows × 6 columns</p>
</div></div></div>
</div>
</div>
<div class="section" id="previewing-a-data-file-before-reading-it-into-python">
<h3>Previewing a data file before reading it into Python<a class="headerlink" href="#previewing-a-data-file-before-reading-it-into-python" title="Permalink to this headline">¶</a></h3>
<p>In all the examples above, we gave you previews of the data file before we read
it into Python. Previewing data is essential to see whether or not there are column
names, what the delimiters are, and if there are lines you need to skip. You
should do this yourself when trying to read in data files. You can preview
files in a plain text editor by right-clicking on the file, selecting “Open
With,” and choosing a plain text editor (e.g., Notepad).</p>
</div>
</div>
<div class="section" id="reading-tabular-data-from-a-microsoft-excel-file">
<h2>Reading tabular data from a Microsoft Excel file<a class="headerlink" href="#reading-tabular-data-from-a-microsoft-excel-file" title="Permalink to this headline">¶</a></h2>
<p>There are many other ways to store tabular data sets beyond plain text files,
and similarly, many ways to load those data sets into Python. For example, it is
very common to encounter, and need to load into Python, data stored as a Microsoft
Excel \index{Excel spreadsheet}\index{Microsoft Excel|see{Excel
spreadsheet}}\index{xlsx|see{Excel spreadsheet}} spreadsheet (with the file name
extension <code class="docutils literal notranslate"><span class="pre">.xlsx</span></code>).  To be able to do this, a key thing to know is that even
though <code class="docutils literal notranslate"><span class="pre">.csv</span></code> and <code class="docutils literal notranslate"><span class="pre">.xlsx</span></code> files look almost identical when loaded into Excel,
the data themselves are stored completely differently.  While <code class="docutils literal notranslate"><span class="pre">.csv</span></code> files are
plain text files, where the characters you see when you open the file in a text
editor are exactly the data they represent, this is not the case for <code class="docutils literal notranslate"><span class="pre">.xlsx</span></code>
files. Take a look at a snippet of what a <code class="docutils literal notranslate"><span class="pre">.xlsx</span></code> file would look like in a text editor:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>,?&#39;O
    _rels/.rels???J1??&gt;E?{7?
&lt;?V????w8?&#39;J???&#39;QrJ???Tf?d??d?o?wZ&#39;???@&gt;?4&#39;?|??hlIo??F
t                                                       8f??3wn
????t??u&quot;/
          %~Ed2??&lt;?w??
                       ?Pd(??J-?E???7?&#39;t(?-GZ?????y???c~N?g[^_r?4
                                                                  yG?O
                                                                      ?K??G?
                                                                      
                                                                                                                    
     ]TUEe??O??c[???????6q??s??d?m???\???H?^????3} ?rZY? ?:L60?^?????XTP+?|?
X?a??4VT?,D?Jq
</pre></div>
</div>
<p>This type of file representation allows Excel files to store additional things
that you cannot store in a <code class="docutils literal notranslate"><span class="pre">.csv</span></code> file, such as fonts, text formatting,
graphics, multiple sheets and more. And despite looking odd in a plain text
editor, we can read Excel spreadsheets into Python using the <code class="docutils literal notranslate"><span class="pre">pandas</span></code> package’s <code class="docutils literal notranslate"><span class="pre">read_excel</span></code>
function developed specifically for this
purpose. \index{readxl}\index{read function!read_excel}</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">canlang_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s2">&quot;data/can_lang.xlsx&quot;</span><span class="p">)</span>
<span class="n">canlang_data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>category</th>
      <th>language</th>
      <th>mother_tongue</th>
      <th>most_at_home</th>
      <th>most_at_work</th>
      <th>lang_known</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Aboriginal languages</td>
      <td>Aboriginal languages, n.o.s.</td>
      <td>590</td>
      <td>235</td>
      <td>30</td>
      <td>665</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Afrikaans</td>
      <td>10260</td>
      <td>4785</td>
      <td>85</td>
      <td>23415</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Afro-Asiatic languages, n.i.e.</td>
      <td>1150</td>
      <td>445</td>
      <td>10</td>
      <td>2775</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Akan (Twi)</td>
      <td>13460</td>
      <td>5985</td>
      <td>25</td>
      <td>22150</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Albanian</td>
      <td>26895</td>
      <td>13135</td>
      <td>345</td>
      <td>31930</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>209</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Wolof</td>
      <td>3990</td>
      <td>1385</td>
      <td>10</td>
      <td>8240</td>
    </tr>
    <tr>
      <th>210</th>
      <td>Aboriginal languages</td>
      <td>Woods Cree</td>
      <td>1840</td>
      <td>800</td>
      <td>75</td>
      <td>2665</td>
    </tr>
    <tr>
      <th>211</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Wu (Shanghainese)</td>
      <td>12915</td>
      <td>7650</td>
      <td>105</td>
      <td>16530</td>
    </tr>
    <tr>
      <th>212</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Yiddish</td>
      <td>13555</td>
      <td>7085</td>
      <td>895</td>
      <td>20985</td>
    </tr>
    <tr>
      <th>213</th>
      <td>Non-Official &amp; Non-Aboriginal languages</td>
      <td>Yoruba</td>
      <td>9080</td>
      <td>2615</td>
      <td>15</td>
      <td>22415</td>
    </tr>
  </tbody>
</table>
<p>214 rows × 6 columns</p>
</div></div></div>
</div>
<p>If the <code class="docutils literal notranslate"><span class="pre">.xlsx</span></code> file has multiple sheets, you have to use the <code class="docutils literal notranslate"><span class="pre">sheet_name</span></code> argument
to specify the sheet number or name. You can also specify cell ranges using the
<code class="docutils literal notranslate"><span class="pre">usecols</span></code> argument(Example:  <code class="docutils literal notranslate"><span class="pre">usecols=&quot;A:D&quot;</span></code> for including cells from <code class="docutils literal notranslate"><span class="pre">A</span></code> to <code class="docutils literal notranslate"><span class="pre">D</span></code>).
This functionality is useful when a single sheet contains
multiple tables (a sad thing that happens to many Excel spreadsheets since this
makes reading in data more difficult).</p>
<p>As with plain text files, you should always explore the data file before
importing it into Python. Exploring the data beforehand helps you decide which
arguments you need to load the data into Python successfully. If you do not have
the Excel program on your computer, you can use other programs to preview the
file. Examples include Google Sheets and Libre Office.</p>
<p>In <a class="reference internal" href="#read-func"><span class="std std-numref">Table 2</span></a> we summarize the <code class="docutils literal notranslate"><span class="pre">read_*</span></code> functions we covered
in this chapter. We also include the <code class="docutils literal notranslate"><span class="pre">read_csv2</span></code> function for data separated by
semicolons <code class="docutils literal notranslate"><span class="pre">;</span></code>, which you may run into with data sets where the decimal is
represented by a comma instead of a period (as with some data sets from
European countries).</p>
<table class="table" id="read-func">
<caption><span class="caption-number">Table 2 </span><span class="caption-text">Summary of read_* functions</span><a class="headerlink" href="#read-func" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Data File Type</p></th>
<th class="head"><p>Python Function</p></th>
<th class="head"><p>Python Package</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Comma (<code class="docutils literal notranslate"><span class="pre">,</span></code>) separated files</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">read_csv</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">pandas</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Tab (<code class="docutils literal notranslate"><span class="pre">\t</span></code>) separated files</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">read_csv</span></code> with <code class="docutils literal notranslate"><span class="pre">sep</span></code> argument</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">pandas</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Semicolon (<code class="docutils literal notranslate"><span class="pre">;</span></code>) separated files</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">read_csv</span></code> with <code class="docutils literal notranslate"><span class="pre">sep</span></code> argument</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">pandas</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Various formats (<code class="docutils literal notranslate"><span class="pre">.csv</span></code>, <code class="docutils literal notranslate"><span class="pre">.tsv</span></code>)</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">read_table</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">pandas</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Excel files (<code class="docutils literal notranslate"><span class="pre">.xlsx</span></code>)</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">read_excel</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">pandas</span></code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="reading-data-from-a-database">
<h2>Reading data from a database<a class="headerlink" href="#reading-data-from-a-database" title="Permalink to this headline">¶</a></h2>
<p>Another very common form of data storage is the relational database. Databases
\index{database} are great when you have large data sets or multiple users
working on a project. There are many relational database management systems,
such as SQLite, MySQL, PostgreSQL, Oracle, and many more. These
different relational database management systems each have their own advantages
and limitations. Almost all employ SQL (<em>structured query language</em>) to obtain
data from the database. But you don’t need to know SQL to analyze data from
a database; several packages have been written that allow you to connect to
relational databases and use the Python programming language
to obtain data. In this book, we will give examples of how to do this
using Python with SQLite and PostgreSQL databases.</p>
<div class="section" id="reading-data-from-a-sqlite-database">
<h3>Reading data from a SQLite database<a class="headerlink" href="#reading-data-from-a-sqlite-database" title="Permalink to this headline">¶</a></h3>
<p>SQLite \index{database!SQLite} is probably the simplest relational database system
that one can use in combination with Python. SQLite databases are self-contained and
usually stored and accessed locally on one computer. Data is usually stored in
a file with a <code class="docutils literal notranslate"><span class="pre">.db</span></code> extension. Similar to Excel files, these are not plain text
files and cannot be read in a plain text editor.</p>
<p>The first thing you need to do to read data into Python from a database is to
connect to the database. We do that using the <code class="docutils literal notranslate"><span class="pre">create_engine</span></code> function from the
<code class="docutils literal notranslate"><span class="pre">sal</span></code> (SQLAlchemy) package. \index{database!connect} This does not read
in the data, but simply tells Python where the database is and opens up a
communication channel that Python can use to send SQL commands to the database.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlalchemy</span> <span class="k">as</span> <span class="nn">sal</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span><span class="p">,</span> <span class="n">select</span><span class="p">,</span> <span class="n">MetaData</span><span class="p">,</span> <span class="n">Table</span>


<span class="n">db</span> <span class="o">=</span> <span class="n">sal</span><span class="o">.</span><span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;sqlite:///data/can_lang.db&quot;</span><span class="p">)</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Often relational databases have many tables; thus, in order to retrieve
data from a database, you need to know the name of the table
in which the data is stored. You can get the names of
all the tables in the database using the <code class="docutils literal notranslate"><span class="pre">table_names</span></code> \index{database!tables}
function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tables</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">table_names</span><span class="p">()</span>
<span class="n">tables</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;can_lang&#39;]
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">table_names</span></code> function returned only one name, which tells us
that there is only one table in this database. To reference a table in the
database (so that we can perform operations like selecting columns and filtering rows), we
use the <code class="docutils literal notranslate"><span class="pre">select</span></code> function \index{database!tbl} from the <code class="docutils literal notranslate"><span class="pre">sqlalchemy</span></code> package. The object returned
by the <code class="docutils literal notranslate"><span class="pre">select</span></code> function \index{dbplyr|see{database}}\index{database!dbplyr} allows us to work with data
stored in databases as if they were just regular data frames; but secretly, behind
the scenes, <code class="docutils literal notranslate"><span class="pre">sqlalchemy</span></code> is turning your function calls (e.g., <code class="docutils literal notranslate"><span class="pre">select</span></code>)
into SQL queries! To access the table in the database, we first declare the <code class="docutils literal notranslate"><span class="pre">metadata</span></code> of the table using
<code class="docutils literal notranslate"><span class="pre">sqlalchemy</span></code> package and then access the table using <code class="docutils literal notranslate"><span class="pre">select</span></code> function from <code class="docutils literal notranslate"><span class="pre">sqlalchemy</span></code> package.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metadata</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s1">&#39;can_lang&#39;</span><span class="p">,</span> 
    <span class="n">metadata</span><span class="p">,</span> 
    <span class="n">autoload</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
    <span class="n">autoload_with</span><span class="o">=</span><span class="n">db</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">table</span><span class="p">])</span>
<span class="n">canlang_data_db</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
<span class="n">canlang_data_db</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;sqlalchemy.engine.cursor.LegacyCursorResult at 0x16e21ac40&gt;
</pre></div>
</div>
</div>
</div>
<p>Although it looks like we just got a data frame from the database, we didn’t!
It’s a <em>reference</em>; the data is still stored only in the SQLite database. The output
is a <code class="docutils literal notranslate"><span class="pre">CursorResult</span></code>(indicating that Python does not know how many rows
there are in total!) object.
In order to actually retrieve this data in Python,
we use the <code class="docutils literal notranslate"><span class="pre">fetchall()</span></code> function. \index{filter}The
<code class="docutils literal notranslate"><span class="pre">sqlalchemy</span></code> package works this way because databases are often more efficient at selecting, filtering
and joining large data sets than Python. And typically the database will not even
be stored on your computer, but rather a more powerful machine somewhere on the
web. So Python is lazy and waits to bring this data into memory until you explicitly
tell it to using the <code class="docutils literal notranslate"><span class="pre">fetchall</span></code> \index{database!collect} function. The <code class="docutils literal notranslate"><span class="pre">fetchall</span></code> function returns the
result of the query in the form of a list, where each row in the table is an element in the list.
Let’s look at the first 10 rows in the table.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">canlang_data_db</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<span class="n">canlang_data_db</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;Aboriginal languages&#39;, &#39;Aboriginal languages, n.o.s.&#39;, 590.0, 235.0, 30.0, 665.0),
 (&#39;Non-Official &amp; Non-Aboriginal languages&#39;, &#39;Afrikaans&#39;, 10260.0, 4785.0, 85.0, 23415.0),
 (&#39;Non-Official &amp; Non-Aboriginal languages&#39;, &#39;Afro-Asiatic languages, n.i.e.&#39;, 1150.0, 445.0, 10.0, 2775.0),
 (&#39;Non-Official &amp; Non-Aboriginal languages&#39;, &#39;Akan (Twi)&#39;, 13460.0, 5985.0, 25.0, 22150.0),
 (&#39;Non-Official &amp; Non-Aboriginal languages&#39;, &#39;Albanian&#39;, 26895.0, 13135.0, 345.0, 31930.0),
 (&#39;Aboriginal languages&#39;, &#39;Algonquian languages, n.i.e.&#39;, 45.0, 10.0, 0.0, 120.0),
 (&#39;Aboriginal languages&#39;, &#39;Algonquin&#39;, 1260.0, 370.0, 40.0, 2480.0),
 (&#39;Non-Official &amp; Non-Aboriginal languages&#39;, &#39;American Sign Language&#39;, 2685.0, 3020.0, 1145.0, 21930.0),
 (&#39;Non-Official &amp; Non-Aboriginal languages&#39;, &#39;Amharic&#39;, 22465.0, 12785.0, 200.0, 33670.0),
 (&#39;Non-Official &amp; Non-Aboriginal languages&#39;, &#39;Arabic&#39;, 419890.0, 223535.0, 5585.0, 629055.0)]
</pre></div>
</div>
</div>
</div>
<p>We can look at the SQL commands that are sent to the database when we write
<code class="docutils literal notranslate"><span class="pre">conn.execute(query).fetchall()</span></code> in Python with the <code class="docutils literal notranslate"><span class="pre">query.compile</span></code> function from the
<code class="docutils literal notranslate"><span class="pre">sqlalchemy</span></code> package. \index{database!show_query}</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">compiled</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">compile_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;render_postcompile&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">compiled</span><span class="p">)</span> <span class="o">%</span> <span class="n">compiled</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SELECT can_lang.category, can_lang.language, can_lang.mother_tongue, can_lang.most_at_home, can_lang.most_at_work, can_lang.lang_known 
FROM can_lang
</pre></div>
</div>
</div>
</div>
<p>The output above shows the SQL code that is sent to the database. When we
write <code class="docutils literal notranslate"><span class="pre">conn.execute(query).fetchall()</span></code> in Python, in the background, the function is
translating the Python code into SQL, sending that SQL to the database, and then translating the
response for us. So <code class="docutils literal notranslate"><span class="pre">sqlalchemy</span></code> does all the hard work of translating from Python to SQL and back for us;
we can just stick with Python!</p>
<p>With our <code class="docutils literal notranslate"><span class="pre">canlang_data_db</span></code> table reference for the 2016 Canadian Census data in hand, we
can mostly continue onward as if it were a regular data frame. For example,
we can use the <code class="docutils literal notranslate"><span class="pre">select</span></code> function along with <code class="docutils literal notranslate"><span class="pre">where</span></code> function
to obtain only certain rows. Below we filter the data to include only Aboriginal languages using
the <code class="docutils literal notranslate"><span class="pre">where</span></code> function of <code class="docutils literal notranslate"><span class="pre">sqlalchemy</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">table</span><span class="p">])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">category</span> <span class="o">==</span> <span class="s1">&#39;Aboriginal languages&#39;</span><span class="p">)</span>
<span class="n">result_proxy</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
<span class="n">result_proxy</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;sqlalchemy.engine.cursor.LegacyCursorResult at 0x16e21aa00&gt;
</pre></div>
</div>
</div>
</div>
<p>Above you can again see that this data is not actually stored in Python yet:
the output is a <code class="docutils literal notranslate"><span class="pre">CursorResult</span></code>(indicating that Python does not know how many rows
there are in total!) object.
In order to actually retrieve this data in Python as a data frame,
we again use the <code class="docutils literal notranslate"><span class="pre">fetchall()</span></code> function. \index{filter}
Below you will see that after running <code class="docutils literal notranslate"><span class="pre">fetchall()</span></code>, Python knows that the retrieved
data has 67 rows, and there is no <code class="docutils literal notranslate"><span class="pre">CursorResult</span></code> object listed any more. We will display only the first 10
rows of the table from the list returned by the query.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aboriginal_lang_data_db</span> <span class="o">=</span> <span class="n">result_proxy</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<span class="n">aboriginal_lang_data_db</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;Aboriginal languages&#39;, &#39;Aboriginal languages, n.o.s.&#39;, 590.0, 235.0, 30.0, 665.0),
 (&#39;Aboriginal languages&#39;, &#39;Algonquian languages, n.i.e.&#39;, 45.0, 10.0, 0.0, 120.0),
 (&#39;Aboriginal languages&#39;, &#39;Algonquin&#39;, 1260.0, 370.0, 40.0, 2480.0),
 (&#39;Aboriginal languages&#39;, &#39;Athabaskan languages, n.i.e.&#39;, 50.0, 10.0, 0.0, 85.0),
 (&#39;Aboriginal languages&#39;, &#39;Atikamekw&#39;, 6150.0, 5465.0, 1100.0, 6645.0),
 (&#39;Aboriginal languages&#39;, &quot;Babine (Wetsuwet&#39;en)&quot;, 110.0, 20.0, 10.0, 210.0),
 (&#39;Aboriginal languages&#39;, &#39;Beaver&#39;, 190.0, 50.0, 0.0, 340.0),
 (&#39;Aboriginal languages&#39;, &#39;Blackfoot&#39;, 2815.0, 1110.0, 85.0, 5645.0),
 (&#39;Aboriginal languages&#39;, &#39;Carrier&#39;, 1025.0, 250.0, 15.0, 2100.0),
 (&#39;Aboriginal languages&#39;, &#39;Cayuga&#39;, 45.0, 10.0, 10.0, 125.0)]
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">sqlalchemy</span></code> provides many more functions (not just <code class="docutils literal notranslate"><span class="pre">select</span></code>, <code class="docutils literal notranslate"><span class="pre">where</span></code>)
that you can use to directly feed the database reference (<code class="docutils literal notranslate"><span class="pre">aboriginal_lang_data_db</span></code>) into
downstream analysis functions (e.g., <code class="docutils literal notranslate"><span class="pre">altair</span></code> for data visualization).
But <code class="docutils literal notranslate"><span class="pre">sqlalchemy</span></code> does not provide <em>every</em> function that we need for analysis;
we do eventually need to call <code class="docutils literal notranslate"><span class="pre">fetchall</span></code>.</p>
<p>Does the result returned by <code class="docutils literal notranslate"><span class="pre">fetchall</span></code> function store it as a dataframe? Let’s look
what happens when we try to use <code class="docutils literal notranslate"><span class="pre">shape</span></code> to count rows in a dataframe \index{nrow}</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">aboriginal_lang_data_db</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## AttributeError: &#39;list&#39; object has no attribute &#39;shape&#39;</span>
</pre></div>
</div>
<p>or <code class="docutils literal notranslate"><span class="pre">tail</span></code> to preview the last six rows of a data frame:
\index{tail}</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">aboriginal_lang_data_db</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## AttributeError: &#39;list&#39; object has no attribute &#39;tail&#39;</span>
</pre></div>
</div>
<p>Oops! We cannot treat the result as a dataframe, hence we need to convert it
to a dataframe after calling <code class="docutils literal notranslate"><span class="pre">fetchall</span></code> function</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aboriginal_lang_data_db</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">aboriginal_lang_data_db</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">,</span> <span class="s1">&#39;language&#39;</span><span class="p">,</span> <span class="s1">&#39;mother_tongue&#39;</span><span class="p">,</span> <span class="s1">&#39;most_at_home&#39;</span><span class="p">,</span> <span class="s1">&#39;most_at_work&#39;</span><span class="p">,</span> <span class="s1">&#39;lang_known&#39;</span><span class="p">])</span>
<span class="n">aboriginal_lang_data_db</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(67, 6)
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><p>Additionally, some operations will not work to extract columns or single values
from the reference. Thus, once you have finished
your data wrangling of the database reference object, it is advisable to
bring it into Python using <code class="docutils literal notranslate"><span class="pre">fetchall</span></code> and then converting it into the dataframe using <code class="docutils literal notranslate"><span class="pre">pandas</span></code> package.
But be very careful using <code class="docutils literal notranslate"><span class="pre">fetchall</span></code>: databases are often <em>very</em> big,
and reading an entire table into Python might take a long time to run or even possibly
crash your machine. So make sure you use <code class="docutils literal notranslate"><span class="pre">where</span></code> and <code class="docutils literal notranslate"><span class="pre">select</span></code> on the database table
to reduce the data to a reasonable size before using <code class="docutils literal notranslate"><span class="pre">fetchall</span></code> to read it into Python!</p>
</div></blockquote>
</div>
<div class="section" id="reading-data-from-a-postgresql-database">
<h3>Reading data from a PostgreSQL database<a class="headerlink" href="#reading-data-from-a-postgresql-database" title="Permalink to this headline">¶</a></h3>
<p>PostgreSQL (also called Postgres) \index{database!PostgreSQL} is a very popular
and open-source option for relational database software.
Unlike SQLite,
PostgreSQL uses a client–server database engine, as it was designed to be used
and accessed on a network. This means that you have to provide more information
to Python when connecting to Postgres databases. The additional information that you
need to include when you call the <code class="docutils literal notranslate"><span class="pre">create_engine</span></code> function is listed below:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">dbname</span></code>: the name of the database (a single PostgreSQL instance can host more than one database)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">host</span></code>: the URL pointing to where the database is located</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">port</span></code>: the communication endpoint between Python and the PostgreSQL database (usually <code class="docutils literal notranslate"><span class="pre">5432</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">user</span></code>: the username for accessing the database</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">password</span></code>: the password for accessing the database</p></li>
</ul>
<p>Additionally, we must use the <code class="docutils literal notranslate"><span class="pre">pgdb</span></code> package instead of <code class="docutils literal notranslate"><span class="pre">sqlalchemy</span></code> in the
<code class="docutils literal notranslate"><span class="pre">create_engine</span></code> function call.  Below we demonstrate how to connect to a version of
the <code class="docutils literal notranslate"><span class="pre">can_mov_db</span></code> database, which contains information about Canadian movies.
Note that the <code class="docutils literal notranslate"><span class="pre">host</span></code> (<code class="docutils literal notranslate"><span class="pre">fakeserver.stat.ubc.ca</span></code>), <code class="docutils literal notranslate"><span class="pre">user</span></code> (<code class="docutils literal notranslate"><span class="pre">user0001</span></code>), and
<code class="docutils literal notranslate"><span class="pre">password</span></code> (<code class="docutils literal notranslate"><span class="pre">abc123</span></code>) below are <em>not real</em>; you will not actually
be able to connect to a database using this information.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">pgdb</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: pgdb in /Users/navyadahiya/opt/miniconda3/envs/dsci/lib/python3.9/site-packages (0.0.11)
Requirement already satisfied: psycopg2-binary&gt;=2.8.2 in /Users/navyadahiya/opt/miniconda3/envs/dsci/lib/python3.9/site-packages (from pgdb) (2.9.3)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Note: you may need to restart the kernel to use updated packages.
</pre></div>
</div>
</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># !pip install pgdb</span>
<span class="kn">import</span> <span class="nn">pgdb</span>
<span class="kn">import</span> <span class="nn">sqlalchemy</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>

<span class="c1"># connection_str = &quot;postgresql://&lt;USERNAME&gt;:&lt;PASSWORD&gt;@&lt;IP_ADDRESS&gt;:&lt;PORT&gt;/&lt;DATABASE_NAME&gt;&quot;</span>
<span class="n">connection_str</span> <span class="o">=</span> <span class="s2">&quot;postgresql://user0001:abc123@fakeserver.stat.ubc.ca:5432/can_mov_db&quot;</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="n">connection_str</span><span class="p">)</span>
<span class="n">conn_mov_data</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>

</pre></div>
</div>
<p>After opening the connection, everything looks and behaves almost identically
to when we were using an SQLite database in Python. For example, we can again use
<code class="docutils literal notranslate"><span class="pre">table_names</span></code> to find out what tables are in the <code class="docutils literal notranslate"><span class="pre">can_mov_db</span></code> database:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tables</span> <span class="o">=</span> <span class="n">conn_mov_data</span><span class="o">.</span><span class="n">table_names</span><span class="p">()</span>
<span class="n">tables</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;themes&#39;</span><span class="p">,</span> <span class="s1">&#39;medium&#39;</span><span class="p">,</span> <span class="s1">&#39;titles&#39;</span><span class="p">,</span> <span class="s1">&#39;title_aliases&#39;</span><span class="p">,</span> <span class="s1">&#39;forms&#39;</span><span class="p">,</span> <span class="s1">&#39;episodes&#39;</span><span class="p">,</span> <span class="s1">&#39;names&#39;</span><span class="p">,</span> <span class="s1">&#39;names_occupations&#39;</span><span class="p">,</span> <span class="s1">&#39;occupation&#39;</span><span class="p">,</span> <span class="s1">&#39;ratings&#39;</span><span class="p">]</span>

</pre></div>
</div>
<p>We see that there are 10 tables in this database. Let’s first look at the
<code class="docutils literal notranslate"><span class="pre">&quot;ratings&quot;</span></code> table to find the lowest rating that exists in the <code class="docutils literal notranslate"><span class="pre">can_mov_db</span></code>
database. To access the table’s contents we first need to declare the <code class="docutils literal notranslate"><span class="pre">metadata</span></code> of the table
and store it in a variable named <code class="docutils literal notranslate"><span class="pre">ratings</span></code>. Then, we can use the <code class="docutils literal notranslate"><span class="pre">select</span></code> function to
refer to the data in the table and return the result in python using <code class="docutils literal notranslate"><span class="pre">fetchall</span></code> function, just like
we did for the SQLite database.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">metadata</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">ratings</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s1">&#39;ratings&#39;</span><span class="p">,</span> 
    <span class="n">metadata</span><span class="p">,</span> 
    <span class="n">autoload</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
    <span class="n">autoload_with</span><span class="o">=</span><span class="n">db</span>
<span class="p">)</span>

<span class="n">query</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">ratings</span><span class="p">])</span>
<span class="n">ratings_proxy</span> <span class="o">=</span> <span class="n">conn_mov_data</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[(</span><span class="s1">&#39;The Grand Seduction&#39;</span><span class="p">,</span> <span class="mf">6.6</span><span class="p">,</span> <span class="mi">150</span><span class="p">),</span>
<span class="p">(</span><span class="s1">&#39;Rhymes for Young Ghouls&#39;</span><span class="p">,</span> <span class="mf">6.3</span><span class="p">,</span> <span class="mi">1685</span><span class="p">),</span>
<span class="p">(</span><span class="s1">&#39;Mommy&#39;</span><span class="p">,</span> <span class="mf">7.5</span><span class="p">,</span> <span class="mi">1060</span><span class="p">),</span>
<span class="p">(</span><span class="s1">&#39;Incendies&#39;</span><span class="p">,</span> <span class="mf">6.1</span><span class="p">,</span> <span class="mi">1101</span><span class="p">),</span>
<span class="p">(</span><span class="s1">&#39;Bon Cop, Bad Cop&#39;</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="mi">894</span><span class="p">),</span>
<span class="p">(</span><span class="s1">&#39;Goon&#39;</span><span class="p">,</span> <span class="mf">5.5</span><span class="p">,</span> <span class="mi">1111</span><span class="p">),</span>
<span class="p">(</span><span class="s1">&#39;Monsieur Lazhar&#39;</span><span class="p">,</span> <span class="mf">5.6</span><span class="p">,</span><span class="mi">610</span><span class="p">),</span>
<span class="p">(</span><span class="s1">&#39;What if&#39;</span><span class="p">,</span> <span class="mf">5.3</span><span class="p">,</span> <span class="mi">1401</span><span class="p">),</span>
<span class="p">(</span><span class="s1">&#39;The Barbarian Invations&#39;</span><span class="p">,</span> <span class="mf">5.8</span><span class="p">,</span> <span class="mi">99</span>
<span class="p">(</span><span class="s1">&#39;Away from Her&#39;</span><span class="p">,</span> <span class="mf">6.9</span><span class="p">,</span> <span class="mi">2311</span><span class="p">)]</span>

</pre></div>
</div>
<p>To find the lowest rating that exists in the data base, we first need to
extract the <code class="docutils literal notranslate"><span class="pre">average_rating</span></code> column using <code class="docutils literal notranslate"><span class="pre">select</span></code>:
\index{select}</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">avg_rating_db</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">ratings</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">average_rating</span><span class="p">])</span>
<span class="n">avg_rating_db</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="p">[(</span><span class="mf">6.6</span><span class="p">,),</span>
 <span class="p">(</span><span class="mf">6.3</span><span class="p">,),</span>
 <span class="p">(</span><span class="mf">7.5</span><span class="p">,),</span>
 <span class="p">(</span><span class="mf">6.1</span><span class="p">,),</span>
 <span class="p">(</span><span class="mf">7.0</span><span class="p">,),</span>
 <span class="p">(</span><span class="mf">5.5</span><span class="p">,),</span>
 <span class="p">(</span><span class="mf">5.6</span><span class="p">,),</span>
 <span class="p">(</span><span class="mf">5.4</span><span class="p">,),</span>
 <span class="p">(</span><span class="mf">5.8</span><span class="p">,),</span>
 <span class="p">(</span><span class="mf">6.9</span><span class="p">,)]</span>
</pre></div>
</div>
<p>Next we use <code class="docutils literal notranslate"><span class="pre">min</span></code> to find the minimum rating in that column:
\index{min}</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">min</span><span class="p">(</span><span class="n">avg_rating_db</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mf">1.0</span><span class="p">,)</span>
</pre></div>
</div>
<p>We see the lowest rating given to a movie is 1, indicating that it must have
been a really bad movie…</p>
</div>
<div class="section" id="why-should-we-bother-with-databases-at-all">
<h3>Why should we bother with databases at all?<a class="headerlink" href="#why-should-we-bother-with-databases-at-all" title="Permalink to this headline">¶</a></h3>
<p>Opening a database \index{database!reasons to use} stored in a <code class="docutils literal notranslate"><span class="pre">.db</span></code> file
involved a lot more effort than just opening a <code class="docutils literal notranslate"><span class="pre">.csv</span></code>, or any of the
other plain text or Excel formats. It was a bit of a pain to use a database in
that setting since we had to use <code class="docutils literal notranslate"><span class="pre">sqlalchemy</span></code> to translate <code class="docutils literal notranslate"><span class="pre">pandas</span></code>-like
commands (<code class="docutils literal notranslate"><span class="pre">where</span></code>, <code class="docutils literal notranslate"><span class="pre">select</span></code>, etc.) into SQL commands that the database
understands. Not all <code class="docutils literal notranslate"><span class="pre">pandas</span></code> commands can currently be translated with
SQLite databases. For example, we can compute a mean with an SQLite database
but can’t easily compute a median. So you might be wondering: why should we use
databases at all?</p>
<p>Databases are beneficial in a large-scale setting:</p>
<ul class="simple">
<li><p>They enable storing large data sets across multiple computers with backups.</p></li>
<li><p>They provide mechanisms for ensuring data integrity and validating input.</p></li>
<li><p>They provide security and data access control.</p></li>
<li><p>They allow multiple users to access data simultaneously
and remotely without conflicts and errors.
For example, there are billions of Google searches conducted daily in 2021 [&#64;googlesearches].
Can you imagine if Google stored all of the data
from those searches in a single <code class="docutils literal notranslate"><span class="pre">.csv</span></code> file!? Chaos would ensue!</p></li>
</ul>
</div>
</div>
<div class="section" id="writing-data-from-python-to-a-csv-file">
<h2>Writing data from Python to a <code class="docutils literal notranslate"><span class="pre">.csv</span></code> file<a class="headerlink" href="#writing-data-from-python-to-a-csv-file" title="Permalink to this headline">¶</a></h2>
<p>At the middle and end of a data analysis, we often want to write a data frame
that has changed (either through filtering, selecting, mutating or summarizing)
to a file to share it with others or use it for another step in the analysis.
The most straightforward way to do this is to use the <code class="docutils literal notranslate"><span class="pre">to_csv</span></code> function
\index{write function!write_csv} from the <code class="docutils literal notranslate"><span class="pre">pandas</span></code> package.  The default
arguments for this file are to use a comma (<code class="docutils literal notranslate"><span class="pre">,</span></code>) as the delimiter and include
column names. Below we demonstrate creating a new version of the Canadian
languages data set without the official languages category according to the
Canadian 2016 Census, and then writing this to a <code class="docutils literal notranslate"><span class="pre">.csv</span></code> file:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">no_official_lang_data</span> <span class="o">=</span> <span class="n">canlang_data</span><span class="p">[</span><span class="n">canlang_data</span><span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;Official languages&#39;</span><span class="p">]</span>
<span class="n">no_official_lang_data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;data/no_official_languages.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="obtaining-data-from-the-web">
<h2>Obtaining data from the web<a class="headerlink" href="#obtaining-data-from-the-web" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p><strong>Note:</strong> This section is not required reading for the remainder of the textbook. It
is included for those readers interested in learning a little bit more about
how to obtain different types of data from the web.</p>
</div></blockquote>
<p>Data doesn’t just magically appear on your computer; you need to get it from
somewhere. Earlier in the chapter we showed you how to access data stored in a
plain text, spreadsheet-like format (e.g., comma- or tab-separated) from a web
URL using one of the <code class="docutils literal notranslate"><span class="pre">read_*</span></code> functions from the <code class="docutils literal notranslate"><span class="pre">tidyverse</span></code>. But as time goes
on, it is increasingly uncommon to find data (especially large amounts of data)
in this format available for download from a URL. Instead, websites now often
offer something known as an <strong>a</strong>pplication <strong>p</strong>rogramming <strong>i</strong>nterface
(API), \index{application programming interface|see{API}}\index{API} which
provides a programmatic way to ask for subsets of a data set. This allows the
website owner to control <em>who</em> has access to the data, <em>what portion</em> of the
data they have access to, and <em>how much</em> data they can access.  Typically, the
website owner will give you a <em>token</em> (a secret string of characters somewhat
like a password) that you have to provide when accessing the API.</p>
<p>Another interesting thought: websites themselves <em>are</em> data! When you type a
URL into your browser window, your browser asks the <em>web server</em> (another
computer on the internet whose job it is to respond to requests for the
website) to give it the website’s data, and then your browser translates that
data into something you can see. If the website shows you some information that
you’re interested in, you could <em>create</em> a data set for yourself by copying and
pasting that information into a file. This process of taking information
directly from what a website displays is called \index{web scraping}
<em>web scraping</em> (or sometimes <em>screen scraping</em>). Now, of course, copying and pasting
information manually is a painstaking and error-prone process, especially when
there is a lot of information to gather. So instead of asking your browser to
translate the information that the web server provides into something you can
see, you can collect that data programmatically—in the form of
<strong>h</strong>yper<strong>t</strong>ext <strong>m</strong>arkup <strong>l</strong>anguage
(HTML) \index{hypertext markup language|see{HTML}}\index{cascading style sheet|see{CSS}}\index{CSS}\index{HTML}
and <strong>c</strong>ascading <strong>s</strong>tyle <strong>s</strong>heet (CSS) code—and process it
to extract useful information. HTML provides the
basic structure of a site and tells the webpage how to display the content
(e.g., titles, paragraphs, bullet lists etc.), whereas CSS helps style the
content and tells the webpage how the HTML elements should
be presented (e.g., colors, layouts, fonts etc.).</p>
<p>This subsection will show you the basics of both web scraping
with the <a class="reference external" href="https://rvest.tidyverse.org/"><code class="docutils literal notranslate"><span class="pre">rvest</span></code> R package</a> [&#64;rvest]
and accessing the Twitter API
using the <a class="reference external" href="https://github.com/ropensci/rtweet"><code class="docutils literal notranslate"><span class="pre">rtweet</span></code> R package</a> [&#64;rtweet].</p>
<div class="section" id="web-scraping">
<h3>Web scraping<a class="headerlink" href="#web-scraping" title="Permalink to this headline">¶</a></h3>
<div class="section" id="html-and-css-selectors">
<h4>HTML and CSS selectors {-}<a class="headerlink" href="#html-and-css-selectors" title="Permalink to this headline">¶</a></h4>
<p>When you enter a URL into your browser, your browser connects to the
web server at that URL and asks for the <em>source code</em> for the website.
This is the data that the browser translates
\index{web scraping}\index{HTML!selector}\index{CSS!selector}
into something you can see; so if we
are going to create our own data by scraping a website, we have to first understand
what that data looks like! For example, let’s say we are interested
in knowing the average rental price (per square foot) of the most recently
available one-bedroom apartments in Vancouver
on <a class="reference external" href="https://vancouver.craigslist.org">Craiglist</a>. When we visit the Vancouver Craigslist
website \index{Craigslist} and search for one-bedroom apartments,
we should see something similar to Figure &#64;ref(fig:craigslist-human).</p>
<p>Based on what our browser shows us, it’s pretty easy to find the size and price
for each apartment listed. But we would like to be able to obtain that information
using R, without any manual human effort or copying and pasting. We do this by
examining the <em>source code</em> that the web server actually sent our browser to
display for us. We show a snippet of it below; the
entire source
is <a class="reference external" href="https://github.com/UBC-DSCI/introduction-to-datascience/blob/master/img/website_source.txt">included with the code for this book</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;!--         &lt;span class=&quot;result-meta&quot;&gt; --&gt;
&lt;!--                 &lt;span class=&quot;result-price&quot;&gt;$800&lt;/span&gt; --&gt;

&lt;!--                 &lt;span class=&quot;housing&quot;&gt; --&gt;
&lt;!--                     1br - --&gt;
&lt;!--                 &lt;/span&gt; --&gt;

&lt;!--                 &lt;span class=&quot;result-hood&quot;&gt; (13768 108th Avenue)&lt;/span&gt; --&gt;

&lt;!--                 &lt;span class=&quot;result-tags&quot;&gt; --&gt;
&lt;!--                     &lt;span class=&quot;maptag&quot; data-pid=&quot;6786042973&quot;&gt;map&lt;/span&gt; --&gt;
&lt;!--                 &lt;/span&gt; --&gt;

&lt;!--                 &lt;span class=&quot;banish icon icon-trash&quot; role=&quot;button&quot;&gt; --&gt;
&lt;!--                     &lt;span class=&quot;screen-reader-text&quot;&gt;hide this posting&lt;/span&gt; --&gt;
&lt;!--                 &lt;/span&gt; --&gt;

&lt;!--             &lt;span class=&quot;unbanish icon icon-trash red&quot; role=&quot;button&quot; aria-hidden --&gt;
&lt;!--             &lt;a href=&quot;#&quot; class=&quot;restore-link&quot;&gt; --&gt;
&lt;!--                 &lt;span class=&quot;restore-narrow-text&quot;&gt;restore&lt;/span&gt; --&gt;
&lt;!--                 &lt;span class=&quot;restore-wide-text&quot;&gt;restore this posting&lt;/span&gt; --&gt;
&lt;!--             &lt;/a&gt; --&gt;

&lt;!--         &lt;/span&gt; --&gt;
&lt;!--     &lt;/p&gt; --&gt;
&lt;!-- &lt;/li&gt; --&gt;
&lt;!--          &lt;li class=&quot;result-row&quot; data-pid=&quot;6788463837&quot;&gt; --&gt;
                  
&lt;!--         &lt;a href=&quot;https://vancouver.craigslist.org/nvn/apa/d/north-vancouver-luxu --&gt;
&lt;!--                 &lt;span class=&quot;result-price&quot;&gt;$2285&lt;/span&gt; --&gt;
&lt;!--         &lt;/a&gt; --&gt;
</pre></div>
</div>
<p>Oof…you can tell that the source code for a web page is not really designed
for humans to understand easily. However, if you look through it closely, you
will find that the information we’re interested in is hidden among the muck.
For example, near the top of the snippet
above you can see a line that looks like</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;span class=&quot;result-price&quot;&gt;$800&lt;/span&gt;
</pre></div>
</div>
<p>That is definitely storing the price of a particular apartment. With some more
investigation, you should be able to find things like the date and time of the
listing, the address of the listing, and more. So this source code most likely
contains all the information we are interested in!</p>
<p>Let’s dig into that line \index{HTML!tag} above a bit more. You can see that
that bit of code has an <em>opening tag</em> (words between <code class="docutils literal notranslate"><span class="pre">&lt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&gt;</span></code>, like
<code class="docutils literal notranslate"><span class="pre">&lt;span&gt;</span></code>) and a <em>closing tag</em> (the same with a slash, like <code class="docutils literal notranslate"><span class="pre">&lt;/span&gt;</span></code>). HTML
source code generally stores its data between opening and closing tags like
these. Tags are keywords that tell the web browser how to display or format
the content. Above you can see that the information we want (<code class="docutils literal notranslate"><span class="pre">$800</span></code>) is stored
between an opening and closing tag (<code class="docutils literal notranslate"><span class="pre">&lt;span&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;/span&gt;</span></code>). In the opening
tag, you can also see a very useful “class” (a special word that is sometimes
included with opening tags): <code class="docutils literal notranslate"><span class="pre">class=&quot;result-price&quot;</span></code>. Since we want R to
programmatically sort through all of the source code for the website to find
apartment prices, maybe we can look for all the tags with the <code class="docutils literal notranslate"><span class="pre">&quot;result-price&quot;</span></code>
class, and grab the information between the opening and closing tag. Indeed,
take a look at another line of the source snippet above:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;span class=&quot;result-price&quot;&gt;$2285&lt;/span&gt;
</pre></div>
</div>
<p>It’s yet another price for an apartment listing, and the tags surrounding it
have the <code class="docutils literal notranslate"><span class="pre">&quot;result-price&quot;</span></code> class. Wonderful! Now that we know what pattern we
are looking for—a dollar amount between opening and closing tags that have the
<code class="docutils literal notranslate"><span class="pre">&quot;result-price&quot;</span></code> class—we should be able to use code to pull out all of the
matching patterns from the source code to obtain our data. This sort of “pattern”
is known as a <em>CSS selector</em> (where CSS stands for <strong>c</strong>ascading <strong>s</strong>tyle <strong>s</strong>heet).</p>
<p>The above was a simple example of “finding the pattern to look for”; many
websites are quite a bit larger and more complex, and so is their website
source code. Fortunately, there are tools available to make this process
easier. For example,
<a class="reference external" href="https://selectorgadget.com/">SelectorGadget</a> is
an open-source tool that simplifies identifying the generating
and finding of CSS selectors.
At the end of the chapter in the additional resources section, we include a link to
a short video on how to install and use the SelectorGadget tool to
obtain CSS selectors for use in web scraping.
After installing and enabling the tool, you can click the
website element for which you want an appropriate selector. For
example, if we click the price of an apartment listing, we
find that SelectorGadget shows us the selector <code class="docutils literal notranslate"><span class="pre">.result-price</span></code>
in its toolbar, and highlights all the other apartment
prices that would be obtained using that selector (Figure &#64;ref(fig:sg1)).</p>
<p>If we then click the size of an apartment listing, SelectorGadget shows us
the <code class="docutils literal notranslate"><span class="pre">span</span></code> selector, and highlights many of the lines on the page; this indicates that the
<code class="docutils literal notranslate"><span class="pre">span</span></code> selector is not specific enough to capture only apartment sizes (Figure &#64;ref(fig:sg3)).</p>
<p>To narrow the selector, we can click one of the highlighted elements that
we <em>do not</em> want. For example, we can deselect the “pic/map” links,
resulting in only the data we want highlighted using the <code class="docutils literal notranslate"><span class="pre">.housing</span></code> selector (Figure &#64;ref(fig:sg2)).</p>
<p>So to scrape information about the square footage and rental price
of apartment listings, we need to use
the two CSS selectors <code class="docutils literal notranslate"><span class="pre">.housing</span></code> and <code class="docutils literal notranslate"><span class="pre">.result-price</span></code>, respectively.
The selector gadget returns them to us as a comma-separated list (here
<code class="docutils literal notranslate"><span class="pre">.housing</span> <span class="pre">,</span> <span class="pre">.result-price</span></code>), which is exactly the format we need to provide to
R if we are using more than one CSS selector.</p>
<p><strong>Stop! Are you allowed to scrape that website?</strong>
<em>Before</em> scraping \index{web scraping!permission} data from the web, you should always check whether or not
you are <em>allowed</em> to scrape it! There are two documents that are important
for this: the <code class="docutils literal notranslate"><span class="pre">robots.txt</span></code> file and the Terms of Service
document. If we take a look at <a class="reference external" href="https://www.craigslist.org/about/terms.of.use">Craigslist’s Terms of Service document</a>,
we find the following text: <em>“You agree not to copy/collect CL content
via robots, spiders, scripts, scrapers, crawlers, or any automated or manual equivalent (e.g., by hand).”</em>
So unfortunately, without explicit permission, we are not allowed to scrape the website.</p>
<p>What to do now? Well, we <em>could</em> ask the owner of Craigslist for permission to scrape.
However, we are not likely to get a response, and even if we did they would not likely give us permission.
The more realistic answer is that we simply cannot scrape Craigslist. If we still want
to find data about rental prices in Vancouver, we must go elsewhere.
To continue learning how to scrape data from the web, let’s instead
scrape data on the population of Canadian cities from Wikipedia. \index{Wikipedia}
We have checked the <a class="reference external" href="https://foundation.wikimedia.org/wiki/Terms_of_Use/en">Terms of Service document</a>,
and it does not mention that web scraping is disallowed.
We will use the SelectorGadget tool to pick elements that we are interested in
(city names and population counts) and deselect others to indicate that we are not
interested in them (province names), as shown in Figure &#64;ref(fig:sg4).</p>
<p>We include a link to a short video tutorial on this process at the end of the chapter
in the additional resources section. SelectorGadget provides in its toolbar
the following list of CSS selectors to use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">td</span><span class="p">:</span><span class="n">nth</span><span class="o">-</span><span class="n">child</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> 
<span class="n">td</span><span class="p">:</span><span class="n">nth</span><span class="o">-</span><span class="n">child</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span> 
<span class="o">.</span><span class="n">infobox</span><span class="p">:</span><span class="n">nth</span><span class="o">-</span><span class="n">child</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span> <span class="n">td</span><span class="p">:</span><span class="n">nth</span><span class="o">-</span><span class="n">child</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> 
<span class="o">.</span><span class="n">infobox</span> <span class="n">td</span><span class="p">:</span><span class="n">nth</span><span class="o">-</span><span class="n">child</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>Now that we have the CSS selectors that describe the properties of the elements
that we want to target (e.g., has a tag name <code class="docutils literal notranslate"><span class="pre">price</span></code>), we can use them to find
certain elements in web pages and extract data.</p>
<p><strong>Using <code class="docutils literal notranslate"><span class="pre">rvest</span></code></strong></p>
<p>Now that we have our CSS selectors we can use the <code class="docutils literal notranslate"><span class="pre">rvest</span></code> R package \index{rvest} to scrape our
desired data from the website. We start by loading the <code class="docutils literal notranslate"><span class="pre">rvest</span></code> package:</p>
<div class="highlight-{r notranslate"><div class="highlight"><pre><span></span>library(rvest)
</pre></div>
</div>
<p>Next, we tell R what page we want to scrape by providing the webpage’s URL in quotations to the function <code class="docutils literal notranslate"><span class="pre">read_html</span></code>:</p>
<div class="highlight-{r notranslate"><div class="highlight"><pre><span></span>page &lt;- read_html(&quot;https://en.wikipedia.org/wiki/Canada&quot;)
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">read_html</span></code> function \index{read function!read_html} directly downloads the source code for the page at
the URL you specify, just like your browser would if you navigated to that site. But
instead of  displaying the website to you, the <code class="docutils literal notranslate"><span class="pre">read_html</span></code> function just returns
the HTML source code itself, which we have
stored in the <code class="docutils literal notranslate"><span class="pre">page</span></code> variable. Next, we send the page object to the <code class="docutils literal notranslate"><span class="pre">html_nodes</span></code>
function, along with the CSS selectors we obtained from
the SelectorGadget tool. Make sure to surround the selectors with quotation marks; the function, <code class="docutils literal notranslate"><span class="pre">html_nodes</span></code>, expects that
argument is a string. The <code class="docutils literal notranslate"><span class="pre">html_nodes</span></code> function then selects <em>nodes</em> from the HTML document that
match the CSS selectors you specified.  A <em>node</em> is an HTML tag pair (e.g.,
<code class="docutils literal notranslate"><span class="pre">&lt;td&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;/td&gt;</span></code> which defines the cell of a table) combined with the content
stored between the tags. For our CSS selector <code class="docutils literal notranslate"><span class="pre">td:nth-child(5)</span></code>, an example
node that would be selected would be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">td</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;text-align:left;background:#f0f0f0;&quot;</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;/wiki/London,_Ontario&quot;</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;London, Ontario&quot;</span><span class="o">&gt;</span><span class="n">London</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>We store the result of the <code class="docutils literal notranslate"><span class="pre">html_nodes</span></code> function in the <code class="docutils literal notranslate"><span class="pre">population_nodes</span></code> variable.
Note that below we use the <code class="docutils literal notranslate"><span class="pre">paste</span></code> function with a comma separator (<code class="docutils literal notranslate"><span class="pre">sep=&quot;,&quot;</span></code>)
to build the list of selectors. The <code class="docutils literal notranslate"><span class="pre">paste</span></code> function converts
elements to characters and combines the values into a list. We use this function to
build the list of selectors to maintain code readability; this avoids
having one very long line of code with the string
<code class="docutils literal notranslate"><span class="pre">&quot;td:nth-child(5),td:nth-child(7),.infobox:nth-child(122)</span> <span class="pre">td:nth-child(1),.infobox</span> <span class="pre">td:nth-child(3)&quot;</span></code>
as the second argument of <code class="docutils literal notranslate"><span class="pre">html_nodes</span></code>:</p>
<div class="highlight-{r notranslate"><div class="highlight"><pre><span></span>selectors &lt;- paste(&quot;td:nth-child(5)&quot;,
             &quot;td:nth-child(7)&quot;,
             &quot;.infobox:nth-child(122) td:nth-child(1)&quot;,
             &quot;.infobox td:nth-child(3)&quot;, sep=&quot;,&quot;)

population_nodes &lt;- html_nodes(page, selectors)
head(population_nodes)
</pre></div>
</div>
<div class="highlight-{r notranslate"><div class="highlight"><pre><span></span>print_html_nodes(head(population_nodes))
</pre></div>
</div>
<p>Next we extract the meaningful data—in other words, we get rid of the HTML code syntax and tags—from
the nodes using the <code class="docutils literal notranslate"><span class="pre">html_text</span></code>
function. In the case of the example
node above, <code class="docutils literal notranslate"><span class="pre">html_text</span></code> function returns <code class="docutils literal notranslate"><span class="pre">&quot;London&quot;</span></code>.</p>
<div class="highlight-{r notranslate"><div class="highlight"><pre><span></span>population_text &lt;- html_text(population_nodes)
head(population_text)
</pre></div>
</div>
<p>Fantastic! We seem to have extracted the data of interest from the
raw HTML source code. But we are not quite done; the data
is not yet in an optimal format for data analysis. Both the city names and
population are encoded as characters in a single vector, instead of being in a
data frame with one character column for city and one numeric column for
population (like a spreadsheet).
Additionally, the populations contain commas (not useful for programmatically
dealing with numbers), and some even contain a line break character at the end
(<code class="docutils literal notranslate"><span class="pre">\n</span></code>). In Chapter &#64;ref(wrangling), we will learn more about how to <em>wrangle</em> data
such as this into a more useful format for data analysis using R.</p>
</div>
</div>
<div class="section" id="using-an-api">
<h3>Using an API<a class="headerlink" href="#using-an-api" title="Permalink to this headline">¶</a></h3>
<p>Rather than posting a data file at a URL for you to download, many websites these days
provide an API \index{API} that must be accessed through a programming language like R. The benefit of this
is that data owners have much more control over the data they provide to users. However, unlike
web scraping, there is no consistent way to access an API across websites. Every website typically
has its own API designed especially for its own use case. Therefore we will just provide one example
of accessing data through an API in this book, with the hope that it gives you enough of a basic
idea that you can learn how to use another API if needed.</p>
<p>In particular, in this book we will show you the basics of how to use
the <code class="docutils literal notranslate"><span class="pre">rtweet</span></code> package in R\index{API!rtweet}\index{rtweet}\index{Twitter} to access
data from the Twitter API. One nice feature of this particular
API is that you don’t need  a special <em>token</em> \index{API!token} to access it; you simply need to
make an account with them. Your access to the data will then be authenticated and controlled through
your account username and password. If you have a Twitter
account already (or are willing to make one), you can follow
along with the examples that we show here. To get started, load the <code class="docutils literal notranslate"><span class="pre">rtweet</span></code> package:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">rtweet</span><span class="p">)</span>
</pre></div>
</div>
<p>This package provides an extensive set of functions to search
Twitter for tweets, users, their followers, and more.
Let’s construct a small data set of the last 400 tweets and
retweets from the &#64;tidyverse account. A few of the most recent tweets
are shown in Figure &#64;ref(fig:01-tidyverse-twitter).</p>
<div class="figure align-default" id="markdown-fig">
<a class="bg-primary mb-2 reference internal image-reference" href="_images/tidyverse_twitter.png"><img alt="twitter feed" class="bg-primary mb-2" src="_images/tidyverse_twitter.png" style="width: 600px; height: 500px;" /></a>
<p class="caption"><span class="caption-number">Fig. 10 </span><span class="caption-text">The tidyverse account Twitter feed.</span><a class="headerlink" href="#markdown-fig" title="Permalink to this image">¶</a></p>
</div>
<p><strong>Stop! Think about your API usage carefully!</strong></p>
<p>When you access an API, you are initiating a transfer of data from a web server
to your computer. Web servers are expensive to run and do not have infinite resources.
If you try to ask for <em>too much data</em> at once, you can use up a huge amount of the server’s bandwidth.
If you try to ask for data <em>too frequently</em>—e.g., if you
make many requests to the server in quick succession—you can also bog the server down and make
it unable to talk to anyone else. Most servers have mechanisms to revoke your access if you are not
careful, but you should try to prevent issues from happening in the first place by being extra careful
with how you write and run your code. You should also keep in mind that when a website owner
grants you API access, they also usually specify a limit (or <em>quota</em>) of how much data you can ask for.
Be careful not to overrun your quota! In this example, we should take a look at
<a class="reference external" href="https://developer.twitter.com/en/docs/twitter-api/rate-limits">the Twitter website</a> to see what limits
we should abide by when using the API.</p>
<p><strong>Using <code class="docutils literal notranslate"><span class="pre">rtweet</span></code></strong></p>
<p>After checking the Twitter website, it seems like asking for 400 tweets one time is acceptable.
So we can use the <code class="docutils literal notranslate"><span class="pre">get_timelines</span></code> function to ask for the last 400 tweets from the &#64;tidyverse account.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">tidyverse_tweets</span> <span class="o">&lt;-</span> <span class="nf">get_timelines</span><span class="p">(</span><span class="s">&#39;tidyverse&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="m">400</span><span class="p">)</span>
</pre></div>
</div>
<p>When you call the <code class="docutils literal notranslate"><span class="pre">get_timelines</span></code> for the first time (or any other <code class="docutils literal notranslate"><span class="pre">rtweet</span></code> function that accesses the API),
you will see a browser pop-up that looks something like Figure &#64;ref(fig:01-tidyverse-authorize).</p>
<p>(ref:01-tidyverse-authorize) The <code class="docutils literal notranslate"><span class="pre">rtweet</span></code> authorization prompt.</p>
<div class="figure align-default" id="id1">
<a class="bg-primary mb-2 reference internal image-reference" href="_images/authorize_question.png"><img alt="authorize" class="bg-primary mb-2" src="_images/authorize_question.png" style="width: 600px; height: 500px;" /></a>
<p class="caption"><span class="caption-number">Fig. 11 </span><span class="caption-text">(ref:01-tidyverse-authorize)</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
<p>This is the <code class="docutils literal notranslate"><span class="pre">rtweet</span></code> package asking you to provide your own Twitter account’s login information.
When <code class="docutils literal notranslate"><span class="pre">rtweet</span></code> talks to the Twitter API, it uses your account information to authenticate requests;
Twitter then can keep track of how much data you’re asking for, and how frequently you’re asking.
If you want to follow along with this example using your own Twitter account, you should read
over the list of permissions you are granting <code class="docutils literal notranslate"><span class="pre">rtweet</span></code> <em>very carefully</em> and make sure you are comfortable
with it. Note that <code class="docutils literal notranslate"><span class="pre">rtweet</span></code> can be used to manage most aspects of your account (make posts, follow others, etc.),
which is why <code class="docutils literal notranslate"><span class="pre">rtweet</span></code> asks for such extensive permissions.
If you decide to allow <code class="docutils literal notranslate"><span class="pre">rtweet</span></code> to talk to the Twitter API using your account information, then
input your username and password and hit “Sign In.” Twitter will probably send you an email to say
that there was an unusual login attempt on your account, and in that case you will have to take
the one-time code they send you and provide that to the <code class="docutils literal notranslate"><span class="pre">rtweet</span></code> login page too.</p>
<blockquote>
<div><p><strong>Note:</strong> Every API has its own way to authenticate users when they try to access data. Many APIs require you to
sign up to receive a <em>token</em>, which is a secret password that you input into the R package (like <code class="docutils literal notranslate"><span class="pre">rtweet</span></code>)
that you are using to access the API.</p>
</div></blockquote>
<p>With the authentication setup out of the way, let’s run the <code class="docutils literal notranslate"><span class="pre">get_timelines</span></code> function again to actually access
the API and take a look at what was returned:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">tidyverse_tweets</span> <span class="o">&lt;-</span> <span class="nf">get_timelines</span><span class="p">(</span><span class="s">&#39;tidyverse&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="m">400</span><span class="p">)</span>
<span class="n">tidyverse_tweets</span>
</pre></div>
</div>
<div class="highlight-{r notranslate"><div class="highlight"><pre><span></span>tidyverse_tweets &lt;- read_csv(&quot;data/tweets.csv&quot;)
tidyverse_tweets
</pre></div>
</div>
<p>The data has quite a few variables! (Notice that the output above shows that we
have a data table with 293 rows and 71 columns). Let’s reduce this down to a
few variables of interest: <code class="docutils literal notranslate"><span class="pre">created_at</span></code>,  <code class="docutils literal notranslate"><span class="pre">retweet_screen_name</span></code>, <code class="docutils literal notranslate"><span class="pre">is_retweet</span></code>,
and <code class="docutils literal notranslate"><span class="pre">text</span></code>.</p>
<div class="highlight-{r notranslate"><div class="highlight"><pre><span></span>tidyverse_tweets &lt;- select(tidyverse_tweets, 
                           created_at, 
                           retweet_screen_name,
                           is_retweet, 
                           text)

tidyverse_tweets
</pre></div>
</div>
<p>If you look back up at the image of the &#64;tidyverse Twitter page, you will
recognize the text of the most recent few tweets in the above data frame.  In
other words, we have successfully created a small data set using the Twitter
API—neat! This data is also quite different from what we obtained from web scraping;
it is already well-organized into a <code class="docutils literal notranslate"><span class="pre">tidyverse</span></code> data frame (although not <em>every</em> API
will provide data in such a nice format).
From this point onward, the <code class="docutils literal notranslate"><span class="pre">tidyverse_tweets</span></code> data frame is stored on your
machine, and you can play with it to your heart’s content. For example, you can use
<code class="docutils literal notranslate"><span class="pre">write_csv</span></code> to save it to a file and <code class="docutils literal notranslate"><span class="pre">read_csv</span></code> to read it into R again later;
and after reading the next few chapters you will have the skills to
compute the percentage of retweets versus tweets, find the most oft-retweeted
account, make visualizations of the data, and much more! If you decide that you want
to ask the Twitter API for more data
(see <a class="reference external" href="https://github.com/ropensci/rtweet">the <code class="docutils literal notranslate"><span class="pre">rtweet</span></code> page</a>
for more examples of what is possible), just be mindful as usual about how much
data you are requesting and how frequently you are making requests.</p>
</div>
</div>
<div class="section" id="exercises">
<h2>Exercises<a class="headerlink" href="#exercises" title="Permalink to this headline">¶</a></h2>
<p>Practice exercises for the material covered in this chapter
can be found in the accompanying
<a class="reference external" href="https://github.com/UBC-DSCI/data-science-a-first-intro-worksheets#readme">worksheets repository</a>
in the “Reading in data locally and from the web” row.
You can launch an interactive version of the worksheet in your browser by clicking the “launch binder” button.
You can also preview a non-interactive version of the worksheet by clicking “view worksheet.”
If you instead decide to download the worksheet and run it on your own machine,
make sure to follow the instructions for computer setup
found in Chapter &#64;ref(move-to-your-own-machine). This will ensure that the automated feedback
and guidance that the worksheets provide will function as intended.</p>
</div>
<div class="section" id="additional-resources">
<h2>Additional resources<a class="headerlink" href="#additional-resources" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>The <a class="reference external" href="https://readr.tidyverse.org/"><code class="docutils literal notranslate"><span class="pre">readr</span></code> documentation</a>
provides the documentation for many of the reading functions we cover in this chapter.
It is where you should look if you want to learn more about the functions in this
chapter, the full set of arguments you can use, and other related functions.
The site also provides a very nice cheat sheet that summarizes many of the data
wrangling functions from this chapter.</p></li>
<li><p>Sometimes you might run into data in such poor shape that none of the reading
functions we cover in this chapter work. In that case, you can consult the
<a class="reference external" href="https://r4ds.had.co.nz/data-import.html">data import chapter</a> from <em>R for Data
Science</em> [&#64;wickham2016r], which goes into a lot more detail about how R parses
text from files into data frames.</p></li>
<li><p>The <a class="reference external" href="https://here.r-lib.org/"><code class="docutils literal notranslate"><span class="pre">here</span></code> R package</a> [&#64;here]
provides a way for you to construct or find your files’ paths.</p></li>
<li><p>The <a class="reference external" href="https://readxl.tidyverse.org/"><code class="docutils literal notranslate"><span class="pre">readxl</span></code> documentation</a> provides more
details on reading data from Excel, such as reading in data with multiple
sheets, or specifying the cells to read in.</p></li>
<li><p>The <a class="reference external" href="https://github.com/leeper/rio"><code class="docutils literal notranslate"><span class="pre">rio</span></code> R package</a> [&#64;rio] provides an alternative
set of tools for reading and writing data in R. It aims to be a “Swiss army
knife” for data reading/writing/converting, and supports a wide variety of data
types (including data formats generated by other statistical software like SPSS
and SAS).</p></li>
<li><p>A <a class="reference external" href="https://www.youtube.com/embed/ephId3mYu9o">video</a> from the Udacity
course <em>Linux Command Line Basics</em> provides a good explanation of absolute versus relative paths.</p></li>
<li><p>If you read the subsection on obtaining data from the web via scraping and
APIs, we provide two companion tutorial video links for how to use the
SelectorGadget tool to obtain desired CSS selectors for:</p>
<ul>
<li><p><a class="reference external" href="https://www.youtube.com/embed/YdIWI6K64zo">extracting the data for apartment listings on Craigslist</a>, and</p></li>
<li><p><a class="reference external" href="https://www.youtube.com/embed/O9HKbdhqYzk">extracting Canadian city names and 2016 populations from Wikipedia</a>.</p></li>
</ul>
</li>
<li><p>The <a class="reference external" href="https://dmi3kno.github.io/polite/"><code class="docutils literal notranslate"><span class="pre">polite</span></code> R package</a> [&#64;polite] provides
a set of tools for responsibly scraping data from websites.</p></li>
</ul>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="intro.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Python and the Pandas</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="wrangling.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Cleaning and wrangling data</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By UBC<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>